-- Call diplomatic restriction functions appropriate to starting a new campaign
function campaign_default_diplomacy_start_new_game()
	-- Default diplomacy restrictions enforced across all campaigns
	apply_default_diplomatic_restrictions();
	apply_separatist_treaty_restrictions();
	apply_DLC06_treaty_restrictions();

	default_diplomacy:apply_default_diplomacy_new_game();
end;

-- Call diplomatic restriction functions appropriate to loading into a game at any point in a campaign
-- Functions which outright exclude diplomatic treaties from a campaign should be placed in here
-- Take care not to modify any diplomatic restrictions that are modified and stored based upon campaign progression :)
function campaign_default_diplomacy_start_any_game()

	-- DLC treaty Restrictions
	apply_DLC01_treaty_restrictions();
	apply_DLC03_treaty_restrictions();
	apply_DLC04_treaty_restrictions();
	apply_DLC05_treaty_restrictions();

	-- Default Diplomacy availability for 3K Main Campaign
	apply_default_diplomatic_availability();

	-- DLC treaty Availability
	apply_DLC04_diplomatic_availability();
	apply_DLC05_diplomatic_availability();
	apply_DLC06_diplomatic_availability();

	-- Yellow Turban treaties
	start_yellow_turban_awaken_from_death_diplomacy_listener();
	start_yt_faction_progression_listeners(); -- Always do after default treaty setups as this will change them.

	default_diplomacy:apply_default_diplomacy_any_game();
end;

--Function: disable_diplomacy
--Description: Disable factions being able to propose diplomatic treaty components to other factions with a reason. Filters can contain comma separated elements. Valid elements are "all", --"faction:faction_key", "subculture:subculture_key" and "culture:culture_key". component_keys is a comma separated list of campaign_diplomacy_treaty_component keys. reason_key is a key from the --campaign_diplomacy_treaty_availability_reasons table.
--Parameters: (String proposer_filter, String recipient_filter, String component_keys, String reason_key)
--Return: (void)

function apply_default_diplomatic_restrictions()
	-- default diplomatic restrictions
	out("* applying default diplomacy restrictions");
	
	------------------------------------------------------
	--------------------- 3K MAIN  -----------------------
	------- Disable Culturaly Sensative Treaties ---------
	------- For All Factions, To Be Enabled On A ---------
	----------- Sub-culture Specific Basis ---------------
	------------------------------------------------------
	cm:modify_model():disable_diplomacy("subculture:3k_main_chinese", "subculture:3k_main_subculture_yellow_turban", "treaty_components_abdicate_demand,treaty_components_abdicate_offer,treaty_components_confederate_proposer,treaty_components_confederate_recipient", "hidden")
	cm:modify_model():disable_diplomacy("subculture:3k_main_subculture_yellow_turban", "subculture:3k_main_chinese", "treaty_components_abdicate_demand,treaty_components_abdicate_offer,treaty_components_confederate_proposer,treaty_components_confederate_recipient", "hidden")

	------------------------------------------------------
	----------------------- 3K MAIN ----------------------
	----- Disable 3k_Main Faction Specific Treaties ------
	-------------------- For Factions --------------------
	------------------------------------------------------
	cm:modify_model():disable_diplomacy("all", "all", "treaty_components_attitude_manipulation_positive,treaty_components_attitude_manipulation_negative,treaty_components_instigate_proxy_war_proposer,treaty_components_coercion,treaty_components_recieve_coercion,treaty_components_tribute_demand,treaty_components_tribute_offer,treaty_components_create_alliance_yuan_shao,treaty_components_create_alliance_yuan_shao_counter_offer,treaty_components_create_coalition_yuan_shao,treaty_components_create_coalition_yuan_shao_counter_offer,treaty_components_coalition_to_alliance_yuan_shao,treaty_components_coalition_to_alliance_yuan_shu,treaty_components_vassalise_proposer_yuan_shu,treaty_components_vassalise_recipient_yuan_shu,treaty_components_instigate_trade_monopoly,treaty_components_recieve_trade_monopoly,treaty_components_acknowledge_legitimacy_demand,treaty_components_acknowledge_legitimacy_offer,treaty_components_liu_bei_confederate_proposer,treaty_components_liu_bei_confederate_recipient,treaty_components_create_alliance_yuan_shu,treaty_components_create_alliance_yuan_shu_counter_offer,treaty_components_create_coalition_yuan_shu,treaty_components_create_coalition_yuan_shu_counter_offer,treaty_components_schemes_resource_offer,treaty_components_multiplayer_victory", "hidden")

	------------------------------------------------------
	----------------------- 3K MAIN ----------------------
	------ Disable 3k_Main Treaties Replaced By ----------
	------ Faction Specific Treaties For Their -----------
	--------------- Respective Factions ------------------
	------------------------------------------------------
	--Restricting Yuan Shao from using default alliance or coalition creation treaty
	cm:modify_model():disable_diplomacy("faction:3k_main_faction_yuan_shao", "all", "treaty_components_create_alliance,treaty_components_create_coalition,treaty_components_coalition_to_alliance,treaty_components_alliance_to_empire,treaty_components_coalition_to_empire,treaty_components_create_empire,treaty_components_create_empire_counter_offer", "hidden")
	--Restricting Yuan Shu from using default alliance, coalition creation treaty or vassalise recipient
	cm:modify_model():disable_diplomacy("faction:3k_main_faction_yuan_shu", "all", "treaty_components_create_alliance,treaty_components_create_coalition,treaty_components_coalition_to_alliance,treaty_components_vassalise_recipient", "hidden")
	--Restricting all factions from proposing default vassalise proposer recipient to Yuan Shu
	cm:modify_model():disable_diplomacy("all", "faction:3k_main_faction_yuan_shu", "treaty_components_vassalise_proposer", "hidden")
	--Restricting Liu Bei from using default confederation treaty	
	cm:modify_model():disable_diplomacy("faction:3k_main_faction_liu_bei", "all", "treaty_components_confederate_recipient", "hidden")
	--Restricting Liu Biao from creating vassals
	cm:modify_model():disable_diplomacy("faction:3k_main_faction_liu_biao", "all", "treaty_components_vassalise_recipient", "hidden")
	--Restricting all factions from offering to become vassals of Liu Biao
	cm:modify_model():disable_diplomacy("all", "faction:3k_main_faction_liu_biao", "treaty_components_vassalise_proposer", "hidden")
	--Restricting Zheng Jiang from creating vassals
	cm:modify_model():disable_diplomacy("faction:3k_main_faction_zheng_jiang", "all", "treaty_components_vassalise_recipient,treaty_components_vassalise_proposer,treaty_components_demand_autonomy,treaty_components_offer_autonomy,treaty_components_liberate_proposer,treaty_components_liberate_recipient,treaty_components_annex_vassal,treaty_components_declare_independence,treaty_components_draw_vassal_into_war,treaty_components_call_vassals_to_arms,treaty_components_vassal_joins_war,treaty_components_vassal_requests_war,treaty_components_vassalise_recipient_yellow_turban,treaty_components_vassalise_recipient_yuan_shu,treaty_components_vassalise_recipient_liu_biao", "hidden")
	--Restricting all factions from offering to become vassals of Zheng Jiang
	cm:modify_model():disable_diplomacy("all", "faction:3k_main_faction_zheng_jiang", "treaty_components_vassalise_recipient,treaty_components_vassalise_proposer,treaty_components_demand_autonomy,treaty_components_offer_autonomy,treaty_components_annex_vassal,treaty_components_declare_independence,treaty_components_draw_vassal_into_war,treaty_components_vassal_joins_war,treaty_components_vassal_requests_war,treaty_components_vassalise_proposer_yellow_turban,treaty_components_vassalise_proposer_yuan_shu,treaty_components_liberate_recipient,treaty_components_liberate_proposer,treaty_components_support_independence_offer,treaty_components_vassalise_proposer_liu_biao", "hidden")
	--Restricting diplomacy between all factions and rebels
	cm:modify_model():disable_diplomacy("faction:3k_main_faction_rebels", "all", "treaty_components_proposer_declares_war_against_target,treaty_components_recipient_declares_war_against_target,treaty_components_abdicate_demand,treaty_components_abdicate_offer,treaty_components_acknowledge_legitimacy_demand,treaty_components_acknowledge_legitimacy_offer,treaty_components_alliance,treaty_components_alliance_democratic,treaty_components_alliance_to_alliance_group_peace,treaty_components_alliance_to_alliance_group_peace_no_vote,treaty_components_alliance_to_alliance_group_peace_no_vote_proposer,treaty_components_alliance_to_alliance_group_peace_no_vote_recipient,treaty_components_alliance_to_alliance_war,treaty_components_alliance_to_alliance_war_no_vote,treaty_components_alliance_to_empire,treaty_components_alliance_to_empire_white_tiger,treaty_components_alliance_to_empire_yuan_shao,treaty_components_alliance_to_faction_group_peace,treaty_components_alliance_to_faction_group_peace_no_vote,treaty_components_alliance_to_faction_war,treaty_components_alliance_to_faction_war_no_vote,treaty_components_ancillary_demand,treaty_components_ancillary_offer,treaty_components_annex_subject,treaty_components_annex_vassal,treaty_components_attitude_manipulation_negative,treaty_components_attitude_manipulation_negative_sima_yue,treaty_components_attitude_manipulation_positive,treaty_components_attitude_manipulation_positive_sima_yue,treaty_components_break_deal_negotiated,treaty_components_break_deal_unilateral,treaty_components_break_food_supply_demand,treaty_components_break_food_supply_offer,treaty_components_break_military_access,treaty_components_break_non_aggression,treaty_components_break_payment_regular_demand,treaty_components_break_payment_regular_demand_twenty_turns,treaty_components_break_payment_regular_offer,treaty_components_break_payment_regular_offer_twenty_turns,treaty_components_break_support_independence,treaty_components_break_support_legitimacy,treaty_components_break_trade,treaty_components_break_trade_monopoly,treaty_components_cai_balance_value,treaty_components_coalition,treaty_components_coalition_split_vote,treaty_components_coalition_to_alliance,treaty_components_coalition_to_alliance_white_tiger,treaty_components_coalition_to_alliance_yuan_shao,treaty_components_coalition_to_alliance_yuan_shu,treaty_components_coalition_to_empire,treaty_components_coalition_to_empire_white_tiger,treaty_components_coalition_to_empire_yuan_shao,treaty_components_coercion,treaty_components_confederate_proposer,treaty_components_confederate_recipient,treaty_components_confederate_recipient_no_conditions,treaty_components_create_alliance,treaty_components_create_alliance_yuan_shao,treaty_components_create_alliance_yuan_shu,treaty_components_create_coalition,treaty_components_create_coalition_white_tiger,treaty_components_create_coalition_yuan_shao,treaty_components_create_coalition_yuan_shu,treaty_components_create_empire,treaty_components_create_empire_counter_offer,treaty_components_create_empire_white_tiger,treaty_components_create_empire_yuan_shao,treaty_components_declare_independence,treaty_components_demand_autonomy,treaty_components_dissolve_empire,treaty_components_draw_vassal_into_war,treaty_components_empire,treaty_components_empire_mobilisation,treaty_components_empire_split_vote,treaty_components_enemy_of_the_han_negative,treaty_components_enemy_of_the_han_positive,treaty_components_faction_to_alliance_group_peace,treaty_components_faction_to_alliance_group_peace_no_vote,treaty_components_faction_to_alliance_war,treaty_components_food_supply_demand,treaty_components_food_supply_offer,treaty_components_forced_end_personal_feud_empress_he,treaty_components_forced_end_personal_feud_generic,treaty_components_governor_independence,treaty_components_group_war,treaty_components_guarentee_autonomy,treaty_components_instigate_proxy_war_proposer,treaty_components_instigate_proxy_war_recipient,treaty_components_instigate_trade_monopoly,treaty_components_issue_Imperial_decree,treaty_components_join_alliance_proposers,treaty_components_join_alliance_recipients,treaty_components_join_coalition_proposer,treaty_components_join_coalition_recipient,treaty_components_join_empire_proposer,treaty_components_join_empire_recipient,treaty_components_join_imperial_colaition_proposer,treaty_components_join_imperial_colaition_recipient,treaty_components_kick_alliance_member,treaty_components_kick_coalition_member,treaty_components_kick_empire_member,treaty_components_kick_empire_member_and_declare_war,treaty_components_liberate_proposer,treaty_components_liberate_recipient,treaty_components_liu_bei_confederate_proposer,treaty_components_liu_bei_confederate_recipient,treaty_components_lu_bu_coercion,treaty_components_lu_bu_receive_coercion,treaty_components_mandated_powers,treaty_components_mandated_powers_demand,treaty_components_mandated_powers_offer,treaty_components_marriage_confederate_proposer,treaty_components_marriage_confederate_recipient,treaty_components_marriage_give_female,treaty_components_marriage_give_female_male,treaty_components_marriage_give_male,treaty_components_marriage_give_male_female,treaty_components_marriage_recieve_female,treaty_components_marriage_recieve_female_male,treaty_components_marriage_recieve_male,treaty_components_marriage_recieve_male_female,treaty_components_master_accepts_war,treaty_components_mercenary_contract,treaty_components_mercenary_contract_proposer_declares_war_against_target,treaty_components_mercenary_contract_recipient_declares_war_against_target,treaty_components_mercenary_counter_contract_proposer_declares_war_against_target,treaty_components_mercenary_counter_contract_recipient_declares_war_against_target,treaty_components_mercenary_employer_signed_peace,treaty_components_military_access,treaty_components_military_alliance_split_vote,treaty_components_multiplayer_victory,treaty_components_non_aggression,treaty_components_offer_autonomy,treaty_components_payment_demand,treaty_components_payment_offer,treaty_components_payment_regular_demand,treaty_components_payment_regular_demand_twenty_turns,treaty_components_payment_regular_offer,treaty_components_payment_regular_offer_twenty_turns,treaty_components_peace,treaty_components_peace_no_event,treaty_components_pending_join_alliance_proposers,treaty_components_pending_join_coalition_proposers,treaty_components_pending_join_empire_proposers,treaty_components_personal_feud,treaty_components_quit_alliance,treaty_components_quit_alliance_and_declare_war,treaty_components_quit_alliance_no_treachery,treaty_components_quit_coalition,treaty_components_quit_coalition_and_declare_war,treaty_components_quit_coalition_no_treachery,treaty_components_quit_empire,treaty_components_quit_empire_and_declare_war,treaty_components_quit_empire_no_treachery,treaty_components_recieve_coercion,treaty_components_recieve_imperial_decree,treaty_components_recieve_threat,treaty_components_recieve_trade_monopoly,treaty_components_region_demand,treaty_components_region_offer,treaty_components_resolve_personal_feud,treaty_components_schemes_resource_demand,treaty_components_schemes_resource_offer,treaty_components_sima_lun_coercion,treaty_components_sima_lun_instigate_proxy_war_proposer,treaty_components_sima_lun_instigate_proxy_war_recipient,treaty_components_sima_lun_recieve_coercion,treaty_components_support_independence,treaty_components_support_independence_demand,treaty_components_support_independence_offer,treaty_components_supporting_legitimacy,treaty_components_take_tribute,treaty_components_threaten,treaty_components_threaten_sanctions,treaty_components_trade,treaty_components_trade_monopoly,treaty_components_tribute_demand,treaty_components_tribute_offer,treaty_components_vassal_demands_protection,treaty_components_vassal_demands_protection_group_war,treaty_components_vassal_han_empire_demands_protection,treaty_components_vassal_han_empire_demands_protection_group_war,treaty_components_vassal_joins_war,treaty_components_vassal_requests_war,treaty_components_vassalage,treaty_components_vassalise_proposer,treaty_components_vassalise_proposer_liu_biao,treaty_components_vassalise_proposer_sima_liang,treaty_components_vassalise_proposer_yellow_turban,treaty_components_vassalise_proposer_yuan_shu,treaty_components_vassalise_recipient,treaty_components_vassalise_recipient_liu_biao,treaty_components_vassalise_recipient_no_conditions,treaty_components_vassalise_recipient_sima_liang,treaty_components_vassalise_recipient_yellow_turban,treaty_components_vassalise_recipient_yuan_shu,treaty_components_war", "hidden")
	cm:modify_model():disable_diplomacy("all", "faction:3k_dlc04_faction_rebels", "treaty_components_proposer_declares_war_against_target,treaty_components_recipient_declares_war_against_target,treaty_components_abdicate_demand,treaty_components_abdicate_offer,treaty_components_acknowledge_legitimacy_demand,treaty_components_acknowledge_legitimacy_offer,treaty_components_alliance,treaty_components_alliance_democratic,treaty_components_alliance_to_alliance_group_peace,treaty_components_alliance_to_alliance_group_peace_no_vote,treaty_components_alliance_to_alliance_group_peace_no_vote_proposer,treaty_components_alliance_to_alliance_group_peace_no_vote_recipient,treaty_components_alliance_to_alliance_war,treaty_components_alliance_to_alliance_war_no_vote,treaty_components_alliance_to_empire,treaty_components_alliance_to_empire_white_tiger,treaty_components_alliance_to_empire_yuan_shao,treaty_components_alliance_to_faction_group_peace,treaty_components_alliance_to_faction_group_peace_no_vote,treaty_components_alliance_to_faction_war,treaty_components_alliance_to_faction_war_no_vote,treaty_components_ancillary_demand,treaty_components_ancillary_offer,treaty_components_annex_subject,treaty_components_annex_vassal,treaty_components_attitude_manipulation_negative,treaty_components_attitude_manipulation_negative_sima_yue,treaty_components_attitude_manipulation_positive,treaty_components_attitude_manipulation_positive_sima_yue,treaty_components_break_deal_negotiated,treaty_components_break_deal_unilateral,treaty_components_break_food_supply_demand,treaty_components_break_food_supply_offer,treaty_components_break_military_access,treaty_components_break_non_aggression,treaty_components_break_payment_regular_demand,treaty_components_break_payment_regular_demand_twenty_turns,treaty_components_break_payment_regular_offer,treaty_components_break_payment_regular_offer_twenty_turns,treaty_components_break_support_independence,treaty_components_break_support_legitimacy,treaty_components_break_trade,treaty_components_break_trade_monopoly,treaty_components_cai_balance_value,treaty_components_coalition,treaty_components_coalition_split_vote,treaty_components_coalition_to_alliance,treaty_components_coalition_to_alliance_white_tiger,treaty_components_coalition_to_alliance_yuan_shao,treaty_components_coalition_to_alliance_yuan_shu,treaty_components_coalition_to_empire,treaty_components_coalition_to_empire_white_tiger,treaty_components_coalition_to_empire_yuan_shao,treaty_components_coercion,treaty_components_confederate_proposer,treaty_components_confederate_recipient,treaty_components_confederate_recipient_no_conditions,treaty_components_create_alliance,treaty_components_create_alliance_yuan_shao,treaty_components_create_alliance_yuan_shu,treaty_components_create_coalition,treaty_components_create_coalition_white_tiger,treaty_components_create_coalition_yuan_shao,treaty_components_create_coalition_yuan_shu,treaty_components_create_empire,treaty_components_create_empire_counter_offer,treaty_components_create_empire_white_tiger,treaty_components_create_empire_yuan_shao,treaty_components_declare_independence,treaty_components_demand_autonomy,treaty_components_dissolve_empire,treaty_components_draw_vassal_into_war,treaty_components_empire,treaty_components_empire_mobilisation,treaty_components_empire_split_vote,treaty_components_enemy_of_the_han_negative,treaty_components_enemy_of_the_han_positive,treaty_components_faction_to_alliance_group_peace,treaty_components_faction_to_alliance_group_peace_no_vote,treaty_components_faction_to_alliance_war,treaty_components_food_supply_demand,treaty_components_food_supply_offer,treaty_components_forced_end_personal_feud_empress_he,treaty_components_forced_end_personal_feud_generic,treaty_components_governor_independence,treaty_components_group_war,treaty_components_guarentee_autonomy,treaty_components_instigate_proxy_war_proposer,treaty_components_instigate_proxy_war_recipient,treaty_components_instigate_trade_monopoly,treaty_components_issue_Imperial_decree,treaty_components_join_alliance_proposers,treaty_components_join_alliance_recipients,treaty_components_join_coalition_proposer,treaty_components_join_coalition_recipient,treaty_components_join_empire_proposer,treaty_components_join_empire_recipient,treaty_components_join_imperial_colaition_proposer,treaty_components_join_imperial_colaition_recipient,treaty_components_kick_alliance_member,treaty_components_kick_coalition_member,treaty_components_kick_empire_member,treaty_components_kick_empire_member_and_declare_war,treaty_components_liberate_proposer,treaty_components_liberate_recipient,treaty_components_liu_bei_confederate_proposer,treaty_components_liu_bei_confederate_recipient,treaty_components_lu_bu_coercion,treaty_components_lu_bu_receive_coercion,treaty_components_mandated_powers,treaty_components_mandated_powers_demand,treaty_components_mandated_powers_offer,treaty_components_marriage_confederate_proposer,treaty_components_marriage_confederate_recipient,treaty_components_marriage_give_female,treaty_components_marriage_give_female_male,treaty_components_marriage_give_male,treaty_components_marriage_give_male_female,treaty_components_marriage_recieve_female,treaty_components_marriage_recieve_female_male,treaty_components_marriage_recieve_male,treaty_components_marriage_recieve_male_female,treaty_components_master_accepts_war,treaty_components_mercenary_contract,treaty_components_mercenary_contract_proposer_declares_war_against_target,treaty_components_mercenary_contract_recipient_declares_war_against_target,treaty_components_mercenary_counter_contract_proposer_declares_war_against_target,treaty_components_mercenary_counter_contract_recipient_declares_war_against_target,treaty_components_mercenary_employer_signed_peace,treaty_components_military_access,treaty_components_military_alliance_split_vote,treaty_components_multiplayer_victory,treaty_components_non_aggression,treaty_components_offer_autonomy,treaty_components_payment_demand,treaty_components_payment_offer,treaty_components_payment_regular_demand,treaty_components_payment_regular_demand_twenty_turns,treaty_components_payment_regular_offer,treaty_components_payment_regular_offer_twenty_turns,treaty_components_peace,treaty_components_peace_no_event,treaty_components_pending_join_alliance_proposers,treaty_components_pending_join_coalition_proposers,treaty_components_pending_join_empire_proposers,treaty_components_personal_feud,treaty_components_quit_alliance,treaty_components_quit_alliance_and_declare_war,treaty_components_quit_alliance_no_treachery,treaty_components_quit_coalition,treaty_components_quit_coalition_and_declare_war,treaty_components_quit_coalition_no_treachery,treaty_components_quit_empire,treaty_components_quit_empire_and_declare_war,treaty_components_quit_empire_no_treachery,treaty_components_recieve_coercion,treaty_components_recieve_imperial_decree,treaty_components_recieve_threat,treaty_components_recieve_trade_monopoly,treaty_components_region_demand,treaty_components_region_offer,treaty_components_resolve_personal_feud,treaty_components_schemes_resource_demand,treaty_components_schemes_resource_offer,treaty_components_sima_lun_coercion,treaty_components_sima_lun_instigate_proxy_war_proposer,treaty_components_sima_lun_instigate_proxy_war_recipient,treaty_components_sima_lun_recieve_coercion,treaty_components_support_independence,treaty_components_support_independence_demand,treaty_components_support_independence_offer,treaty_components_supporting_legitimacy,treaty_components_take_tribute,treaty_components_threaten,treaty_components_threaten_sanctions,treaty_components_trade,treaty_components_trade_monopoly,treaty_components_tribute_demand,treaty_components_tribute_offer,treaty_components_vassal_demands_protection,treaty_components_vassal_demands_protection_group_war,treaty_components_vassal_han_empire_demands_protection,treaty_components_vassal_han_empire_demands_protection_group_war,treaty_components_vassal_joins_war,treaty_components_vassal_requests_war,treaty_components_vassalage,treaty_components_vassalise_proposer,treaty_components_vassalise_proposer_liu_biao,treaty_components_vassalise_proposer_sima_liang,treaty_components_vassalise_proposer_yellow_turban,treaty_components_vassalise_proposer_yuan_shu,treaty_components_vassalise_recipient,treaty_components_vassalise_recipient_liu_biao,treaty_components_vassalise_recipient_no_conditions,treaty_components_vassalise_recipient_sima_liang,treaty_components_vassalise_recipient_yellow_turban,treaty_components_vassalise_recipient_yuan_shu,treaty_components_war", "hidden")
end;


function apply_separatist_treaty_restrictions()
	-----------------------------------------------------
	---------------------- GLOBAL- ----------------------
	----- Every Faction Must Have Diplomacy Disabled ----
	----- With Their Separatist Counter-part Faction ----
	-----------------------------------------------------	
	out("* applying separatist diplomacy restrictions");
	local treaty_set_separatists_restrictions = "treaty_components_alliance_democratic,treaty_components_alliance_to_alliance_war,treaty_components_alliance_to_faction_war,treaty_components_ancillary_demand,treaty_components_ancillary_offer,treaty_components_annex_vassal,treaty_components_break_deal_proposer_to_recipient_unilateral,treaty_components_confederate_proposer,treaty_components_confederate_recipient,treaty_components_create_alliance,treaty_components_declare_independence,treaty_components_draw_vassal_into_war,treaty_components_faction_to_alliance_war,treaty_components_food_supply_demand,treaty_components_food_supply_offer,treaty_components_alliance_to_alliance_group_peace,treaty_components_alliance_to_faction_group_peace,treaty_components_faction_to_alliance_group_peace,treaty_components_group_war,treaty_components_guarentee_autonomy,treaty_components_join_alliance_proposers,treaty_components_join_alliance_recipients,treaty_components_join_coalition_proposer,treaty_components_join_coalition_recipient,treaty_components_liberate_proposer,treaty_components_liberate_recipient,treaty_components_marriage_give_female,treaty_components_marriage_give_female_male,treaty_components_marriage_give_male,treaty_components_marriage_give_male_female,treaty_components_marriage_recieve_female,treaty_components_marriage_recieve_female_male,treaty_components_marriage_recieve_male,treaty_components_marriage_recieve_male_female,treaty_components_military_access,treaty_components_non_aggression,treaty_components_payment_demand,treaty_components_payment_offer,treaty_components_payment_regular_demand,treaty_components_payment_regular_offer,treaty_components_peace,treaty_components_proposer_declares_war_against_target,treaty_components_recipient_declares_war_against_target,treaty_components_region_demand,treaty_components_region_offer,treaty_components_abdicate_demand,treaty_components_threaten,treaty_components_trade,treaty_components_vassalise_proposer,treaty_components_vassalise_recipient,treaty_components_call_vassals_to_arms,treaty_components_create_coalition,treaty_components_offer_autonomy,treaty_components_demand_autonomy,treaty_components_proposer_declares_war_against_target,treaty_components_recipient_declares_war_against_target,treaty_components_vassal_requests_war,treaty_components_vassal_joins_war,treaty_components_abdicate_demand,treaty_components_abdicate_offer,treaty_components_vassalise_recipient_yellow_turban,treaty_components_vassalise_proposer_yellow_turban";
	local query_world = cm:query_model():world();
	local faction_list = query_world:faction_list();
	
	for i = 0, faction_list:num_items() - 1 do
		local current_faction_name = faction_list:item_at(i):name();
		
		if not string.find(current_faction_name, "_separatists") and query_world:faction_exists(current_faction_name .. "_separatists") then
			cm:modify_model():disable_diplomacy("faction:" .. current_faction_name .. "_separatists", "faction:" .. current_faction_name, treaty_set_separatists_restrictions, "hidden");
			cm:modify_model():disable_diplomacy("faction:" .. current_faction_name, "faction:" .. current_faction_name .. "_separatists", treaty_set_separatists_restrictions, "hidden");
		end;
	end;

	local treaty_set_player_restrictions = 	
	"treaty_components_annex_vassal,treaty_components_confederate_proposer,treaty_components_confederate_recipient";
	
	local treaty_set_player_availability = 	
	"treaty_components_multiplayer_victory";
	
	local human_factions = cm:get_human_factions();
	
	for i = 1, #human_factions do
		cm:modify_model():disable_diplomacy("all", "faction:" .. human_factions[i], treaty_set_player_restrictions, "hidden");
		
		for j = 1, #human_factions do
			if i ~= j then
				cm:modify_model():disable_diplomacy("faction:" .. human_factions[i], "faction:" .. human_factions[j], treaty_set_player_restrictions, "hidden");
				cm:modify_model():enable_diplomacy("faction:" .. human_factions[i], "faction:" .. human_factions[j], treaty_set_player_availability, "hidden");
				cm:modify_model():disable_diplomacy("faction:" .. human_factions[j], "faction:" .. human_factions[i], treaty_set_player_restrictions, "hidden");
				cm:modify_model():enable_diplomacy("faction:" .. human_factions[j], "faction:" .. human_factions[i], treaty_set_player_availability, "hidden");
			end;
		end;
	end;
end;


function apply_DLC01_treaty_restrictions()
	------------------------------------------------------
	-----------------------3K DLC01 ----------------------
	------------- Disable Treaties For DLC01 -------------
	------ Yellow Turban Cultures Where Applicable -------
	------------------------------------------------------	
	out("* applying DCL01 diplomacy restrictions");

	-- Restricting Han Chinese from being able to propose confederation treaties (by any name) to Yellow Turbans
	cm:modify_model():disable_diplomacy("subculture:3k_main_chinese", "subculture:3k_main_subculture_yellow_turban", "treaty_components_abdicate_demand,treaty_components_abdicate_offer,treaty_components_confederate_proposer,treaty_components_confederate_recipient,treaty_components_annex_vassal", "hidden")
	-- Restricting Yellow Turbans from being able to propose confederation treaties (by any name) to Han Chinese
	cm:modify_model():disable_diplomacy("subculture:3k_main_subculture_yellow_turban", "subculture:3k_main_chinese", "treaty_components_abdicate_demand,treaty_components_abdicate_offer,treaty_components_confederate_proposer,treaty_components_confederate_recipient,treaty_components_annex_vassal", "hidden")
	-- Restringing all factions from being able to propose Yellow Turban faction specific vassalage
	cm:modify_model():disable_diplomacy("subculture:3k_main_chinese", "subculture:3k_main_chinese", "treaty_components_vassalise_proposer_yellow_turban,treaty_components_vassalise_recipient_yellow_turban", "hidden")
	--Restricting Yellow Turban factions from being able to propose marriages
	cm:modify_model():disable_diplomacy("subculture:3k_main_subculture_yellow_turban", "all", "treaty_components_marriage_give_female,treaty_components_marriage_give_female_male,treaty_components_marriage_give_male,treaty_components_marriage_give_male_female,treaty_components_marriage_recieve_female,treaty_components_marriage_recieve_female_male,treaty_components_marriage_recieve_male,treaty_components_marriage_recieve_male_female,treaty_components_marriage_confederate_proposer,treaty_components_marriage_confederate_recipient","hidden")
	--Restricting Yellow Turban factions from being able to recieve marriages
	cm:modify_model():disable_diplomacy("all", "subculture:3k_main_subculture_yellow_turban", "treaty_components_marriage_give_female,treaty_components_marriage_give_female_male,treaty_components_marriage_give_male,treaty_components_marriage_give_male_female,treaty_components_marriage_recieve_female,treaty_components_marriage_recieve_female_male,treaty_components_marriage_recieve_male,treaty_components_marriage_recieve_male_female,treaty_components_marriage_confederate_proposer,treaty_components_marriage_confederate_recipient","hidden")
	-- Restricting han/ytr peace by progression level. GUAN-4485
	cm:modify_model():disable_diplomacy("subculture:3k_main_subculture_yellow_turban", "subculture:3k_main_chinese", "treaty_components_peace,treaty_components_alliance_to_alliance_group_peace,treaty_components_alliance_to_faction_group_peace,treaty_components_faction_to_alliance_group_peace,treaty_components_threaten,treaty_components_faction_to_alliance_war,treaty_components_alliance_to_alliance_war,treaty_components_alliance_to_faction_war,treaty_components_coercion,treaty_components_call_vassals_to_arms,treaty_components_group_war,treaty_components_proposer_declares_war_against_target,treaty_components_recipient_declares_war_against_target,treaty_components_region_demand,treaty_components_region_offer,treaty_components_payment_demand,treaty_components_payment_offer,treaty_components_payment_regular_demand,treaty_components_payment_regular_offer,treaty_components_ancillary_demand,treaty_components_ancillary_offer", "yellow_turban_rank_requirement_proposer")
	cm:modify_model():disable_diplomacy("subculture:3k_main_chinese", "subculture:3k_main_subculture_yellow_turban", "treaty_components_peace,treaty_components_alliance_to_alliance_group_peace,treaty_components_alliance_to_faction_group_peace,treaty_components_faction_to_alliance_group_peace,treaty_components_threaten,treaty_components_faction_to_alliance_war,treaty_components_alliance_to_alliance_war,treaty_components_alliance_to_faction_war,treaty_components_coercion,treaty_components_call_vassals_to_arms,treaty_components_group_war,treaty_components_proposer_declares_war_against_target,treaty_components_recipient_declares_war_against_target,treaty_components_region_demand,treaty_components_region_offer,treaty_components_payment_demand,treaty_components_payment_offer,treaty_components_payment_regular_demand,treaty_components_payment_regular_offer,treaty_components_ancillary_demand,treaty_components_ancillary_offer", "yellow_turban_rank_requirement_recipient")
	--Restricting Yellow Turban factions from negotiating with Han Chinese factions based on rank progression
	cm:modify_model():disable_diplomacy("subculture:3k_main_subculture_yellow_turban", "subculture:3k_main_chinese", "treaty_components_threaten,treaty_components_coercion,treaty_components_region_demand,treaty_components_region_offer,treaty_components_payment_demand,treaty_components_payment_offer,treaty_components_payment_regular_demand,treaty_components_payment_regular_offer,treaty_components_ancillary_demand,treaty_components_ancillary_offer,treaty_components_trade,treaty_components_food_supply_demand,treaty_components_food_supply_offer,treaty_components_confederate_proposer,treaty_components_confederate_recipient,treaty_components_create_empire,treaty_components_create_alliance,treaty_components_declare_independence,treaty_components_draw_vassal_into_war,treaty_components_join_empire_proposer,treaty_components_join_empire_recipient,treaty_components_join_alliance_proposers,treaty_components_join_alliance_recipients,treaty_components_join_coalition_proposer,treaty_components_join_coalition_recipient,treaty_components_liberate_proposer,treaty_components_liberate_recipient,treaty_components_military_access,treaty_components_non_aggression,treaty_components_vassalise_proposer,treaty_components_vassalise_recipient,treaty_components_create_coalition,treaty_components_offer_autonomy,treaty_components_demand_autonomy,treaty_components_vassal_requests_war,treaty_components_vassal_joins_war", "yellow_turban_rank_requirement_proposer")
	--Restricting Han Chinese factions from negotiating with Yellow Turban factions based on rank progression
	cm:modify_model():disable_diplomacy("subculture:3k_main_chinese", "subculture:3k_main_subculture_yellow_turban", "treaty_components_threaten,treaty_components_coercion,treaty_components_region_demand,treaty_components_region_offer,treaty_components_payment_demand,treaty_components_payment_offer,treaty_components_payment_regular_demand,treaty_components_payment_regular_offer,treaty_components_ancillary_demand,treaty_components_ancillary_offer,treaty_components_trade,treaty_components_food_supply_demand,treaty_components_food_supply_offer,treaty_components_confederate_proposer,treaty_components_confederate_recipient,treaty_components_create_empire,treaty_components_create_alliance,treaty_components_declare_independence,treaty_components_draw_vassal_into_war,treaty_components_join_empire_proposer,treaty_components_join_empire_recipient,treaty_components_join_alliance_proposers,treaty_components_join_alliance_recipients,treaty_components_join_coalition_proposer,treaty_components_join_coalition_recipient,treaty_components_liberate_proposer,treaty_components_liberate_recipient,treaty_components_military_access,treaty_components_non_aggression,treaty_components_vassalise_proposer,treaty_components_vassalise_recipient,treaty_components_create_coalition,treaty_components_offer_autonomy,treaty_components_demand_autonomy,treaty_components_vassal_requests_war,treaty_components_vassal_joins_war", "yellow_turban_rank_requirement_recipient")
	--Restricting Yellow Turban factions from negotiating with Bandits 
	cm:modify_model():disable_diplomacy("subculture:3k_main_subculture_yellow_turban", "subculture:3k_dlc05_subculture_bandits", "treaty_components_threaten,treaty_components_coercion,treaty_components_region_demand,treaty_components_region_offer,treaty_components_payment_demand,treaty_components_payment_offer,treaty_components_payment_regular_demand,treaty_components_payment_regular_offer,treaty_components_ancillary_demand,treaty_components_ancillary_offer,treaty_components_trade,treaty_components_food_supply_demand,treaty_components_food_supply_offer,treaty_components_confederate_proposer,treaty_components_confederate_recipient,treaty_components_create_empire,treaty_components_create_alliance,treaty_components_declare_independence,treaty_components_draw_vassal_into_war,treaty_components_join_empire_proposer,treaty_components_join_empire_recipient,treaty_components_join_alliance_proposers,treaty_components_join_alliance_recipients,treaty_components_join_coalition_proposer,treaty_components_join_coalition_recipient,treaty_components_liberate_proposer,treaty_components_liberate_recipient,treaty_components_military_access,treaty_components_non_aggression,treaty_components_annex_vassal,treaty_components_vassalise_proposer,treaty_components_vassalise_recipient,treaty_components_create_coalition,treaty_components_offer_autonomy,treaty_components_demand_autonomy,treaty_components_vassal_requests_war,treaty_components_vassal_joins_war", "yellow_turban_rank_requirement_proposer")
	--Restricting Bandit factions from negotiating with Yellow Turbans
	cm:modify_model():disable_diplomacy("subculture:3k_dlc05_subculture_bandits", "subculture:3k_main_subculture_yellow_turban", "treaty_components_threaten,treaty_components_coercion,treaty_components_region_demand,treaty_components_region_offer,treaty_components_payment_demand,treaty_components_payment_offer,treaty_components_payment_regular_demand,treaty_components_payment_regular_offer,treaty_components_ancillary_demand,treaty_components_ancillary_offer,treaty_components_trade,treaty_components_food_supply_demand,treaty_components_food_supply_offer,treaty_components_confederate_proposer,treaty_components_confederate_recipient,treaty_components_create_empire,treaty_components_create_alliance,treaty_components_declare_independence,treaty_components_draw_vassal_into_war,treaty_components_join_empire_proposer,treaty_components_join_empire_recipient,treaty_components_join_alliance_proposers,treaty_components_join_alliance_recipients,treaty_components_join_coalition_proposer,treaty_components_join_coalition_recipient,treaty_components_liberate_proposer,treaty_components_liberate_recipient,treaty_components_military_access,treaty_components_non_aggression,treaty_components_annex_vassal,treaty_components_vassalise_proposer,treaty_components_vassalise_recipient,treaty_components_create_coalition,treaty_components_offer_autonomy,treaty_components_demand_autonomy,treaty_components_vassal_requests_war,treaty_components_vassal_joins_war", "yellow_turban_rank_requirement_recipient")
	--Restricting Yellow Turban factions from creating regrular vassals with Han Chinese
	cm:modify_model():disable_diplomacy("subculture:3k_main_subculture_yellow_turban", "subculture:3k_main_chinese", "treaty_components_vassalise_recipient,treaty_components_vassalise_proposer_yellow_turban", "hidden")
	--Restricting Yellow Turbans from using their cross-culture vassalage until progression rank is reached
	cm:modify_model():disable_diplomacy("subculture:3k_main_subculture_yellow_turban", "subculture:3k_main_chinese", "treaty_components_vassalise_recipient_yellow_turban", "yellow_turban_rank_requirement_proposer")
	--Restricting Han Chinese factions from offering to become vassals of Yellow Turbans
	cm:modify_model():disable_diplomacy("subculture:3k_main_chinese", "subculture:3k_main_subculture_yellow_turban", "treaty_components_vassalise_proposer,treaty_components_vassalise_recipient_yellow_turban", "hidden")
	--Restricting Yellow Turbans from recieving cross-culture vassalage offers until progression rank is reached
	cm:modify_model():disable_diplomacy("subculture:3k_main_chinese", "subculture:3k_main_subculture_yellow_turban", "treaty_components_vassalise_proposer_yellow_turban", "yellow_turban_rank_requirement_recipient")
	--Restricting Yellow Turbans from using their cross-culture vassilisation feature with their own culture
	cm:modify_model():disable_diplomacy("subculture:3k_main_subculture_yellow_turban", "subculture:3k_main_subculture_yellow_turban", "treaty_components_vassalise_recipient_yellow_turban,treaty_components_vassalise_proposer_yellow_turban", "hidden")
	--Restricting Yellow Turban rebel group from engaging in diplomacy with Yellow Turban playable factions
	cm:modify_model():disable_diplomacy("faction:3k_main_faction_yellow_turban_generic", "subculture:3k_main_subculture_yellow_turban", "treaty_components_alliance_democratic,treaty_components_alliance_to_alliance_war,treaty_components_alliance_to_faction_war,treaty_components_ancillary_demand,treaty_components_ancillary_offer,treaty_components_annex_vassal,treaty_components_break_deal_proposer_to_recipient_unilateral,treaty_components_confederate_proposer,treaty_components_confederate_recipient,treaty_components_create_alliance,treaty_components_declare_independence,treaty_components_draw_vassal_into_war,treaty_components_faction_to_alliance_war,treaty_components_food_supply_demand,treaty_components_food_supply_offer,treaty_components_alliance_to_alliance_group_peace,treaty_components_alliance_to_faction_group_peace,treaty_components_faction_to_alliance_group_peace,treaty_components_group_war,treaty_components_guarentee_autonomy,treaty_components_join_alliance_proposers,treaty_components_join_alliance_recipients,treaty_components_join_coalition_proposer,treaty_components_join_coalition_recipient,treaty_components_liberate_proposer,treaty_components_liberate_recipient,treaty_components_marriage_give_female,treaty_components_marriage_give_female_male,treaty_components_marriage_give_male,treaty_components_marriage_give_male_female,treaty_components_marriage_recieve_female,treaty_components_marriage_recieve_female_male,treaty_components_marriage_recieve_male,treaty_components_marriage_recieve_male_female,treaty_components_military_access,treaty_components_non_aggression,treaty_components_payment_demand,treaty_components_payment_offer,treaty_components_payment_regular_demand,treaty_components_payment_regular_offer,treaty_components_peace,treaty_components_proposer_declares_war_against_target,treaty_components_recipient_declares_war_against_target,treaty_components_region_demand,treaty_components_region_offer,treaty_components_abdicate_demand,treaty_components_threaten,treaty_components_trade,treaty_components_vassalise_proposer,treaty_components_vassalise_recipient,treaty_components_call_vassals_to_arms,treaty_components_create_coalition,treaty_components_offer_autonomy,treaty_components_demand_autonomy,treaty_components_vassal_requests_war,treaty_components_vassal_joins_war", "hidden")
	--Restricting Yellow Turban playable factions from engaging in diplomacy with Yellow Turban rebel group
	cm:modify_model():disable_diplomacy("subculture:3k_main_subculture_yellow_turban", "faction:3k_main_faction_yellow_turban_generic",  "treaty_components_alliance_democratic,treaty_components_alliance_to_alliance_war,treaty_components_alliance_to_faction_war,treaty_components_ancillary_demand,treaty_components_ancillary_offer,treaty_components_annex_vassal,treaty_components_break_deal_proposer_to_recipient_unilateral,treaty_components_confederate_proposer,treaty_components_confederate_recipient,treaty_components_create_alliance,treaty_components_declare_independence,treaty_components_draw_vassal_into_war,treaty_components_faction_to_alliance_war,treaty_components_food_supply_demand,treaty_components_food_supply_offer,treaty_components_alliance_to_alliance_group_peace,treaty_components_alliance_to_faction_group_peace,treaty_components_faction_to_alliance_group_peace,treaty_components_group_war,treaty_components_guarentee_autonomy,treaty_components_join_alliance_proposers,treaty_components_join_alliance_recipients,treaty_components_join_coalition_proposer,treaty_components_join_coalition_recipient,treaty_components_liberate_proposer,treaty_components_liberate_recipient,treaty_components_marriage_give_female,treaty_components_marriage_give_female_male,treaty_components_marriage_give_male,treaty_components_marriage_give_male_female,treaty_components_marriage_recieve_female,treaty_components_marriage_recieve_female_male,treaty_components_marriage_recieve_male,treaty_components_marriage_recieve_male_female,treaty_components_military_access,treaty_components_non_aggression,treaty_components_payment_demand,treaty_components_payment_offer,treaty_components_payment_regular_demand,treaty_components_payment_regular_offer,treaty_components_peace,treaty_components_proposer_declares_war_against_target,treaty_components_recipient_declares_war_against_target,treaty_components_region_demand,treaty_components_region_offer,treaty_components_abdicate_demand,treaty_components_threaten,treaty_components_trade,treaty_components_vassalise_proposer,treaty_components_vassalise_recipient,treaty_components_call_vassals_to_arms,treaty_components_create_coalition,treaty_components_offer_autonomy,treaty_components_demand_autonomy,treaty_components_vassal_requests_war,treaty_components_vassal_joins_war,treaty_components_support_independence_offer,treaty_components_abdicate_offer", "hidden")
	--Restricting diplomacy between rebels and all factions
	cm:modify_model():disable_diplomacy("faction:3k_main_faction_rebels", "all", "treaty_components_alliance_democratic,treaty_components_alliance_to_alliance_war,treaty_components_alliance_to_faction_war,treaty_components_ancillary_demand,treaty_components_ancillary_offer,treaty_components_annex_vassal,treaty_components_break_deal_proposer_to_recipient_unilateral,treaty_components_confederate_proposer,treaty_components_confederate_recipient,treaty_components_create_alliance,treaty_components_declare_independence,treaty_components_draw_vassal_into_war,treaty_components_faction_to_alliance_war,treaty_components_food_supply_demand,treaty_components_food_supply_offer,treaty_components_alliance_to_alliance_group_peace,treaty_components_alliance_to_faction_group_peace,treaty_components_faction_to_alliance_group_peace,treaty_components_group_war,treaty_components_guarentee_autonomy,treaty_components_join_alliance_proposers,treaty_components_join_alliance_recipients,treaty_components_join_coalition_proposer,treaty_components_join_coalition_recipient,treaty_components_liberate_proposer,treaty_components_liberate_recipient,treaty_components_marriage_give_female,treaty_components_marriage_give_female_male,treaty_components_marriage_give_male,treaty_components_marriage_give_male_female,treaty_components_marriage_recieve_female,treaty_components_marriage_recieve_female_male,treaty_components_marriage_recieve_male,treaty_components_marriage_recieve_male_female,treaty_components_military_access,treaty_components_non_aggression,treaty_components_payment_demand,treaty_components_payment_offer,treaty_components_payment_regular_demand,treaty_components_payment_regular_offer,treaty_components_peace,treaty_components_proposer_declares_war_against_target,treaty_components_recipient_declares_war_against_target,treaty_components_region_demand,treaty_components_region_offer,treaty_components_abdicate_demand,treaty_components_threaten,treaty_components_trade,treaty_components_vassalise_proposer,treaty_components_vassalise_recipient,treaty_components_call_vassals_to_arms,treaty_components_create_coalition,treaty_components_offer_autonomy,treaty_components_demand_autonomy,treaty_components_proposer_declares_war_against_target,treaty_components_recipient_declares_war_against_target,treaty_components_vassal_requests_war,treaty_components_vassal_joins_war,treaty_components_abdicate_demand,treaty_components_abdicate_offer,treaty_components_vassalise_recipient_yellow_turban,treaty_components_vassalise_proposer_yellow_turban,treaty_components_support_independence_offer", "hidden")
end;


function apply_DLC03_treaty_restrictions()
	------------------------------------------------------
	---------------------- 3K DLC03 ----------------------
	---------- Disable DLC03 Specific Treaties -----------
	-------------------- For Factions --------------------
	------------------------------------------------------
	out("* applying DCL03 diplomacy restrictions");

	cm:modify_model():disable_diplomacy("all", "all", "treaty_components_sima_lun_recieve_coercion,treaty_components_attitude_manipulation_positive_sima_yue,treaty_components_attitude_manipulation_negative_sima_yue,treaty_components_sima_lun_instigate_proxy_war_proposer,treaty_components_sima_lun_coercion,treaty_components_vassalise_proposer_sima_liang,treaty_components_vassalise_recipient_sima_liang", "hidden")
end;


function apply_DLC04_treaty_restrictions()
	------------------------------------------------------
	---------------------- 3K DLC04 ----------------------
	---------- Disable DLC04 Specific Treaties -----------
	-------------------- For Factions --------------------
	------------------------------------------------------
	out("* applying DCL04 diplomacy restrictions");

	cm:modify_model():disable_diplomacy("all", "all", "treaty_components_annex_subject,treaty_components_create_empire_yuan_shao,treaty_components_create_empire_yuan_shao_counter_offer,treaty_components_alliance_to_empire_yuan_shao,treaty_components_coalition_to_empire_yuan_shao,treaty_components_mandated_powers_demand,treaty_components_mandated_powers_offer,treaty_components_vassalise_proposer_liu_biao,treaty_components_vassalise_recipient_liu_biao", "hidden")
end;


function apply_DLC05_treaty_restrictions()
	------------------------------------------------------
	---------------------- 3K DLC05 ----------------------
	---------- Disable DLC05 Specific Treaties -----------
	-------------------- For Factions --------------------
	------------------------------------------------------
	out("* applying DCL05 diplomacy restrictions");

	-- Restricting Bandit factions from being able to propose confederation treaties (by any name) to Han Chinese
	cm:modify_model():disable_diplomacy("subculture:3k_dlc05_subculture_bandits", "subculture:3k_main_chinese", "treaty_components_abdicate_demand,treaty_components_abdicate_offer,treaty_components_confederate_proposer,treaty_components_confederate_recipient,treaty_components_annex_vassal,treaty_components_vassalise_proposer_yellow_turban,treaty_components_vassalise_recipient_yellow_turban", "hidden")
	-- Restricting Yellow Turbans from being able to propose confederation treaties (by any name) to Han Chinese
	cm:modify_model():disable_diplomacy("subculture:3k_main_chinese", "subculture:3k_dlc05_subculture_bandits", "treaty_components_abdicate_demand,treaty_components_abdicate_offer,treaty_components_confederate_proposer,treaty_components_confederate_recipient,treaty_components_annex_vassal,treaty_components_vassalise_proposer_yellow_turban,treaty_components_vassalise_recipient_yellow_turban", "hidden")
	-- Restricting Bandit factions from being able to propose confederation treaties (by any name) to Yellow Turbans
	cm:modify_model():disable_diplomacy("subculture:3k_dlc05_subculture_bandits", "subculture:3k_main_subculture_yellow_turban", "treaty_components_abdicate_demand,treaty_components_abdicate_offer,treaty_components_confederate_proposer,treaty_components_confederate_recipient,treaty_components_annex_vassal", "hidden")
	-- Restricting Yellow Turbans from being able to propose confederation treaties (by any name) to Bandit factions
	cm:modify_model():disable_diplomacy("subculture:3k_main_subculture_yellow_turban", "subculture:3k_dlc05_subculture_bandits", "treaty_components_abdicate_demand,treaty_components_abdicate_offer,treaty_components_confederate_proposer,treaty_components_confederate_recipient,treaty_components_annex_vassal", "hidden")
	--Restricting Bandit factions from using non-Yellow Turban specific vassalage between themselves
	cm:modify_model():disable_diplomacy("subculture:3k_dlc05_subculture_bandits","subculture:3k_dlc05_subculture_bandits", "treaty_components_vassalise_proposer_yellow_turban,treaty_components_vassalise_recipient_yellow_turban", "hidden")
	--Restricting Bandit factions from using non-Yellow Turban specific vassalage treaty when negotiating vassalage with Yellow Turbans
	cm:modify_model():disable_diplomacy("subculture:3k_dlc05_subculture_bandits", "subculture:3k_main_subculture_yellow_turban", "treaty_components_vassalise_proposer,treaty_components_vassalise_recipient_yellow_turban", "hidden")
	--Restricting Yellow Turban factions from using non-Yellow Turban specific vassalage treaty when negotiating vassalage with Bandits
	cm:modify_model():disable_diplomacy("subculture:3k_main_subculture_yellow_turban", "subculture:3k_dlc05_subculture_bandits", "treaty_components_vassalise_recipient,treaty_components_vassalise_proposer_yellow_turban", "hidden")
	-- Restricting all factions from using Yan Baihu's alliance or coalition variants
	cm:modify_model():disable_diplomacy("all", "all", "treaty_components_create_alliance_white_tiger,treaty_components_create_alliance_white_tiger_counter_offer,treaty_components_create_coalition_white_tiger,treaty_components_create_coalition_white_tiger_counter_offer,treaty_components_coalition_to_alliance_white_tiger,treaty_components_create_empire_white_tiger,treaty_components_create_empire_white_tiger_counter_offer,treaty_components_coalition_to_empire_white_tiger,treaty_components_alliance_to_empire_white_tiger,treaty_components_mercenary_contract_proposer_declares_war_against_target,treaty_components_mercenary_contract_recipient_declares_war_against_target", "hidden")
	-- Restricting all factions from using Lu Bu's coercion variants
	cm:modify_model():disable_diplomacy("all", "all", "treaty_components_lu_bu_coercion,treaty_components_lu_bu_receive_coercion", "hidden")		
	-- Restricting Yan Baihu from using default alliance or coalition creation treaties, including counteroffers to create empires
	cm:modify_model():disable_diplomacy("faction:3k_dlc05_faction_white_tiger_yan", "all", "treaty_components_create_alliance,treaty_components_create_coalition,treaty_components_coalition_to_alliance,treaty_components_alliance_to_empire,treaty_components_coalition_to_empire,treaty_components_create_empire, treaty_components_create_empire_white_tiger_counter_offer,treaty_components_create_alliance_white_tiger_counter_offer,treaty_components_create_coalition_white_tiger_counter_offer,treaty_components_create_empire_counter_offer", "hidden")
	-- Restricting Bandit factions from being able to propose mercenary and vassal treaties to Yellow Turbans based on the Yellow Turban progression ranks (enabled once they reach a required progression rank)
	cm:modify_model():disable_diplomacy("subculture:3k_dlc05_subculture_bandits", "subculture:3k_main_subculture_yellow_turban", "treaty_components_vassalise_proposer_yellow_turban,treaty_components_mercenary_contract_proposer_declares_war_against_target,treaty_components_mercenary_counter_contract_proposer_declares_war_against_target", "yellow_turban_rank_requirement_recipient")
	-- Restricting Yellow Turban factions from being able to propose mercenary and vassal treaties to Bandit based on the Yellow Turban progression ranks (enabled once they reach a required progression rank)
	cm:modify_model():disable_diplomacy("subculture:3k_main_subculture_yellow_turban", "subculture:3k_dlc05_subculture_bandit", "treaty_components_vassalise_recipient_yellow_turban,treaty_components_mercenary_contract_recipient_declares_war_against_target,treaty_components_mercenary_counter_contract_recipient_declares_war_against_target", "yellow_turban_rank_requirement_proposer")
end;

function apply_DLC06_treaty_restrictions()
		------------------------------------------------------
	---------------------- 3K DLC06 ----------------------
	---------- Disable DLC06 Specific Treaties -----------
	-------------------- For Factions --------------------
	------------------------------------------------------
	out("* applying DCL06 diplomacy restrictions");

	--Restricting Nanman factions from treaties they need to unlock via tech
	local treaty_list = "treaty_components_mercenary_contract_proposer_declares_war_against_target,treaty_components_mercenary_contract_recipient_declares_war_against_target,treaty_components_mercenary_counter_contract_recipient_declares_war_against_target,treaty_components_mercenary_counter_contract_proposer_declares_war_against_target,treaty_components_create_empire,treaty_components_coalition_to_empire,treaty_components_alliance_to_empire"
	cm:modify_model():disable_diplomacy("subculture:3k_dlc06_subculture_nanman","all",treaty_list,"hidden")
	cm:modify_model():disable_diplomacy("all","subculture:3k_dlc06_subculture_nanman",treaty_list,"hidden")
	cm:modify_model():disable_diplomacy("faction:3k_dlc06_faction_nanman_rebels", "all", "treaty_components_proposer_declares_war_against_target,treaty_components_recipient_declares_war_against_target,treaty_components_abdicate_demand,treaty_components_abdicate_offer,treaty_components_acknowledge_legitimacy_demand,treaty_components_acknowledge_legitimacy_offer,treaty_components_alliance,treaty_components_alliance_democratic,treaty_components_alliance_to_alliance_group_peace,treaty_components_alliance_to_alliance_group_peace_no_vote,treaty_components_alliance_to_alliance_group_peace_no_vote_proposer,treaty_components_alliance_to_alliance_group_peace_no_vote_recipient,treaty_components_alliance_to_alliance_war,treaty_components_alliance_to_alliance_war_no_vote,treaty_components_alliance_to_empire,treaty_components_alliance_to_empire_white_tiger,treaty_components_alliance_to_empire_yuan_shao,treaty_components_alliance_to_faction_group_peace,treaty_components_alliance_to_faction_group_peace_no_vote,treaty_components_alliance_to_faction_war,treaty_components_alliance_to_faction_war_no_vote,treaty_components_ancillary_demand,treaty_components_ancillary_offer,treaty_components_annex_subject,treaty_components_annex_vassal,treaty_components_attitude_manipulation_negative,treaty_components_attitude_manipulation_negative_sima_yue,treaty_components_attitude_manipulation_positive,treaty_components_attitude_manipulation_positive_sima_yue,treaty_components_break_deal_negotiated,treaty_components_break_deal_unilateral,treaty_components_break_food_supply_demand,treaty_components_break_food_supply_offer,treaty_components_break_military_access,treaty_components_break_non_aggression,treaty_components_break_payment_regular_demand,treaty_components_break_payment_regular_demand_twenty_turns,treaty_components_break_payment_regular_offer,treaty_components_break_payment_regular_offer_twenty_turns,treaty_components_break_support_independence,treaty_components_break_support_legitimacy,treaty_components_break_trade,treaty_components_break_trade_monopoly,treaty_components_cai_balance_value,treaty_components_coalition,treaty_components_coalition_split_vote,treaty_components_coalition_to_alliance,treaty_components_coalition_to_alliance_white_tiger,treaty_components_coalition_to_alliance_yuan_shao,treaty_components_coalition_to_alliance_yuan_shu,treaty_components_coalition_to_empire,treaty_components_coalition_to_empire_white_tiger,treaty_components_coalition_to_empire_yuan_shao,treaty_components_coercion,treaty_components_confederate_proposer,treaty_components_confederate_recipient,treaty_components_confederate_recipient_no_conditions,treaty_components_create_alliance,treaty_components_create_alliance_yuan_shao,treaty_components_create_alliance_yuan_shu,treaty_components_create_coalition,treaty_components_create_coalition_white_tiger,treaty_components_create_coalition_yuan_shao,treaty_components_create_coalition_yuan_shu,treaty_components_create_empire,treaty_components_create_empire_counter_offer,treaty_components_create_empire_white_tiger,treaty_components_create_empire_yuan_shao,treaty_components_declare_independence,treaty_components_demand_autonomy,treaty_components_dissolve_empire,treaty_components_draw_vassal_into_war,treaty_components_empire,treaty_components_empire_mobilisation,treaty_components_empire_split_vote,treaty_components_enemy_of_the_han_negative,treaty_components_enemy_of_the_han_positive,treaty_components_faction_to_alliance_group_peace,treaty_components_faction_to_alliance_group_peace_no_vote,treaty_components_faction_to_alliance_war,treaty_components_food_supply_demand,treaty_components_food_supply_offer,treaty_components_forced_end_personal_feud_empress_he,treaty_components_forced_end_personal_feud_generic,treaty_components_governor_independence,treaty_components_group_war,treaty_components_guarentee_autonomy,treaty_components_instigate_proxy_war_proposer,treaty_components_instigate_proxy_war_recipient,treaty_components_instigate_trade_monopoly,treaty_components_issue_Imperial_decree,treaty_components_join_alliance_proposers,treaty_components_join_alliance_recipients,treaty_components_join_coalition_proposer,treaty_components_join_coalition_recipient,treaty_components_join_empire_proposer,treaty_components_join_empire_recipient,treaty_components_join_imperial_colaition_proposer,treaty_components_join_imperial_colaition_recipient,treaty_components_kick_alliance_member,treaty_components_kick_coalition_member,treaty_components_kick_empire_member,treaty_components_kick_empire_member_and_declare_war,treaty_components_liberate_proposer,treaty_components_liberate_recipient,treaty_components_liu_bei_confederate_proposer,treaty_components_liu_bei_confederate_recipient,treaty_components_lu_bu_coercion,treaty_components_lu_bu_receive_coercion,treaty_components_mandated_powers,treaty_components_mandated_powers_demand,treaty_components_mandated_powers_offer,treaty_components_marriage_confederate_proposer,treaty_components_marriage_confederate_recipient,treaty_components_marriage_give_female,treaty_components_marriage_give_female_male,treaty_components_marriage_give_male,treaty_components_marriage_give_male_female,treaty_components_marriage_recieve_female,treaty_components_marriage_recieve_female_male,treaty_components_marriage_recieve_male,treaty_components_marriage_recieve_male_female,treaty_components_master_accepts_war,treaty_components_mercenary_contract,treaty_components_mercenary_contract_proposer_declares_war_against_target,treaty_components_mercenary_contract_recipient_declares_war_against_target,treaty_components_mercenary_counter_contract_proposer_declares_war_against_target,treaty_components_mercenary_counter_contract_recipient_declares_war_against_target,treaty_components_mercenary_employer_signed_peace,treaty_components_military_access,treaty_components_military_alliance_split_vote,treaty_components_multiplayer_victory,treaty_components_non_aggression,treaty_components_offer_autonomy,treaty_components_payment_demand,treaty_components_payment_offer,treaty_components_payment_regular_demand,treaty_components_payment_regular_demand_twenty_turns,treaty_components_payment_regular_offer,treaty_components_payment_regular_offer_twenty_turns,treaty_components_peace,treaty_components_peace_no_event,treaty_components_pending_join_alliance_proposers,treaty_components_pending_join_coalition_proposers,treaty_components_pending_join_empire_proposers,treaty_components_personal_feud,treaty_components_quit_alliance,treaty_components_quit_alliance_and_declare_war,treaty_components_quit_alliance_no_treachery,treaty_components_quit_coalition,treaty_components_quit_coalition_and_declare_war,treaty_components_quit_coalition_no_treachery,treaty_components_quit_empire,treaty_components_quit_empire_and_declare_war,treaty_components_quit_empire_no_treachery,treaty_components_recieve_coercion,treaty_components_recieve_imperial_decree,treaty_components_recieve_threat,treaty_components_recieve_trade_monopoly,treaty_components_region_demand,treaty_components_region_offer,treaty_components_resolve_personal_feud,treaty_components_schemes_resource_demand,treaty_components_schemes_resource_offer,treaty_components_sima_lun_coercion,treaty_components_sima_lun_instigate_proxy_war_proposer,treaty_components_sima_lun_instigate_proxy_war_recipient,treaty_components_sima_lun_recieve_coercion,treaty_components_support_independence,treaty_components_support_independence_demand,treaty_components_support_independence_offer,treaty_components_supporting_legitimacy,treaty_components_take_tribute,treaty_components_threaten,treaty_components_threaten_sanctions,treaty_components_trade,treaty_components_trade_monopoly,treaty_components_tribute_demand,treaty_components_tribute_offer,treaty_components_vassal_demands_protection,treaty_components_vassal_demands_protection_group_war,treaty_components_vassal_han_empire_demands_protection,treaty_components_vassal_han_empire_demands_protection_group_war,treaty_components_vassal_joins_war,treaty_components_vassal_requests_war,treaty_components_vassalage,treaty_components_vassalise_proposer,treaty_components_vassalise_proposer_liu_biao,treaty_components_vassalise_proposer_sima_liang,treaty_components_vassalise_proposer_yellow_turban,treaty_components_vassalise_proposer_yuan_shu,treaty_components_vassalise_recipient,treaty_components_vassalise_recipient_liu_biao,treaty_components_vassalise_recipient_no_conditions,treaty_components_vassalise_recipient_sima_liang,treaty_components_vassalise_recipient_yellow_turban,treaty_components_vassalise_recipient_yuan_shu,treaty_components_war", "hidden")
	cm:modify_model():disable_diplomacy("all", "faction:3k_dlc06_faction_nanman_rebels", "treaty_components_proposer_declares_war_against_target,treaty_components_recipient_declares_war_against_target,treaty_components_abdicate_demand,treaty_components_abdicate_offer,treaty_components_acknowledge_legitimacy_demand,treaty_components_acknowledge_legitimacy_offer,treaty_components_alliance,treaty_components_alliance_democratic,treaty_components_alliance_to_alliance_group_peace,treaty_components_alliance_to_alliance_group_peace_no_vote,treaty_components_alliance_to_alliance_group_peace_no_vote_proposer,treaty_components_alliance_to_alliance_group_peace_no_vote_recipient,treaty_components_alliance_to_alliance_war,treaty_components_alliance_to_alliance_war_no_vote,treaty_components_alliance_to_empire,treaty_components_alliance_to_empire_white_tiger,treaty_components_alliance_to_empire_yuan_shao,treaty_components_alliance_to_faction_group_peace,treaty_components_alliance_to_faction_group_peace_no_vote,treaty_components_alliance_to_faction_war,treaty_components_alliance_to_faction_war_no_vote,treaty_components_ancillary_demand,treaty_components_ancillary_offer,treaty_components_annex_subject,treaty_components_annex_vassal,treaty_components_attitude_manipulation_negative,treaty_components_attitude_manipulation_negative_sima_yue,treaty_components_attitude_manipulation_positive,treaty_components_attitude_manipulation_positive_sima_yue,treaty_components_break_deal_negotiated,treaty_components_break_deal_unilateral,treaty_components_break_food_supply_demand,treaty_components_break_food_supply_offer,treaty_components_break_military_access,treaty_components_break_non_aggression,treaty_components_break_payment_regular_demand,treaty_components_break_payment_regular_demand_twenty_turns,treaty_components_break_payment_regular_offer,treaty_components_break_payment_regular_offer_twenty_turns,treaty_components_break_support_independence,treaty_components_break_support_legitimacy,treaty_components_break_trade,treaty_components_break_trade_monopoly,treaty_components_cai_balance_value,treaty_components_coalition,treaty_components_coalition_split_vote,treaty_components_coalition_to_alliance,treaty_components_coalition_to_alliance_white_tiger,treaty_components_coalition_to_alliance_yuan_shao,treaty_components_coalition_to_alliance_yuan_shu,treaty_components_coalition_to_empire,treaty_components_coalition_to_empire_white_tiger,treaty_components_coalition_to_empire_yuan_shao,treaty_components_coercion,treaty_components_confederate_proposer,treaty_components_confederate_recipient,treaty_components_confederate_recipient_no_conditions,treaty_components_create_alliance,treaty_components_create_alliance_yuan_shao,treaty_components_create_alliance_yuan_shu,treaty_components_create_coalition,treaty_components_create_coalition_white_tiger,treaty_components_create_coalition_yuan_shao,treaty_components_create_coalition_yuan_shu,treaty_components_create_empire,treaty_components_create_empire_counter_offer,treaty_components_create_empire_white_tiger,treaty_components_create_empire_yuan_shao,treaty_components_declare_independence,treaty_components_demand_autonomy,treaty_components_dissolve_empire,treaty_components_draw_vassal_into_war,treaty_components_empire,treaty_components_empire_mobilisation,treaty_components_empire_split_vote,treaty_components_enemy_of_the_han_negative,treaty_components_enemy_of_the_han_positive,treaty_components_faction_to_alliance_group_peace,treaty_components_faction_to_alliance_group_peace_no_vote,treaty_components_faction_to_alliance_war,treaty_components_food_supply_demand,treaty_components_food_supply_offer,treaty_components_forced_end_personal_feud_empress_he,treaty_components_forced_end_personal_feud_generic,treaty_components_governor_independence,treaty_components_group_war,treaty_components_guarentee_autonomy,treaty_components_instigate_proxy_war_proposer,treaty_components_instigate_proxy_war_recipient,treaty_components_instigate_trade_monopoly,treaty_components_issue_Imperial_decree,treaty_components_join_alliance_proposers,treaty_components_join_alliance_recipients,treaty_components_join_coalition_proposer,treaty_components_join_coalition_recipient,treaty_components_join_empire_proposer,treaty_components_join_empire_recipient,treaty_components_join_imperial_colaition_proposer,treaty_components_join_imperial_colaition_recipient,treaty_components_kick_alliance_member,treaty_components_kick_coalition_member,treaty_components_kick_empire_member,treaty_components_kick_empire_member_and_declare_war,treaty_components_liberate_proposer,treaty_components_liberate_recipient,treaty_components_liu_bei_confederate_proposer,treaty_components_liu_bei_confederate_recipient,treaty_components_lu_bu_coercion,treaty_components_lu_bu_receive_coercion,treaty_components_mandated_powers,treaty_components_mandated_powers_demand,treaty_components_mandated_powers_offer,treaty_components_marriage_confederate_proposer,treaty_components_marriage_confederate_recipient,treaty_components_marriage_give_female,treaty_components_marriage_give_female_male,treaty_components_marriage_give_male,treaty_components_marriage_give_male_female,treaty_components_marriage_recieve_female,treaty_components_marriage_recieve_female_male,treaty_components_marriage_recieve_male,treaty_components_marriage_recieve_male_female,treaty_components_master_accepts_war,treaty_components_mercenary_contract,treaty_components_mercenary_contract_proposer_declares_war_against_target,treaty_components_mercenary_contract_recipient_declares_war_against_target,treaty_components_mercenary_counter_contract_proposer_declares_war_against_target,treaty_components_mercenary_counter_contract_recipient_declares_war_against_target,treaty_components_mercenary_employer_signed_peace,treaty_components_military_access,treaty_components_military_alliance_split_vote,treaty_components_multiplayer_victory,treaty_components_non_aggression,treaty_components_offer_autonomy,treaty_components_payment_demand,treaty_components_payment_offer,treaty_components_payment_regular_demand,treaty_components_payment_regular_demand_twenty_turns,treaty_components_payment_regular_offer,treaty_components_payment_regular_offer_twenty_turns,treaty_components_peace,treaty_components_peace_no_event,treaty_components_pending_join_alliance_proposers,treaty_components_pending_join_coalition_proposers,treaty_components_pending_join_empire_proposers,treaty_components_personal_feud,treaty_components_quit_alliance,treaty_components_quit_alliance_and_declare_war,treaty_components_quit_alliance_no_treachery,treaty_components_quit_coalition,treaty_components_quit_coalition_and_declare_war,treaty_components_quit_coalition_no_treachery,treaty_components_quit_empire,treaty_components_quit_empire_and_declare_war,treaty_components_quit_empire_no_treachery,treaty_components_recieve_coercion,treaty_components_recieve_imperial_decree,treaty_components_recieve_threat,treaty_components_recieve_trade_monopoly,treaty_components_region_demand,treaty_components_region_offer,treaty_components_resolve_personal_feud,treaty_components_schemes_resource_demand,treaty_components_schemes_resource_offer,treaty_components_sima_lun_coercion,treaty_components_sima_lun_instigate_proxy_war_proposer,treaty_components_sima_lun_instigate_proxy_war_recipient,treaty_components_sima_lun_recieve_coercion,treaty_components_support_independence,treaty_components_support_independence_demand,treaty_components_support_independence_offer,treaty_components_supporting_legitimacy,treaty_components_take_tribute,treaty_components_threaten,treaty_components_threaten_sanctions,treaty_components_trade,treaty_components_trade_monopoly,treaty_components_tribute_demand,treaty_components_tribute_offer,treaty_components_vassal_demands_protection,treaty_components_vassal_demands_protection_group_war,treaty_components_vassal_han_empire_demands_protection,treaty_components_vassal_han_empire_demands_protection_group_war,treaty_components_vassal_joins_war,treaty_components_vassal_requests_war,treaty_components_vassalage,treaty_components_vassalise_proposer,treaty_components_vassalise_proposer_liu_biao,treaty_components_vassalise_proposer_sima_liang,treaty_components_vassalise_proposer_yellow_turban,treaty_components_vassalise_proposer_yuan_shu,treaty_components_vassalise_recipient,treaty_components_vassalise_recipient_liu_biao,treaty_components_vassalise_recipient_no_conditions,treaty_components_vassalise_recipient_sima_liang,treaty_components_vassalise_recipient_yellow_turban,treaty_components_vassalise_recipient_yuan_shu,treaty_components_war", "hidden")

	local nanman_major_and_minor_factions =
	{
		"3k_dlc06_faction_jiuzhen",
		"3k_dlc06_faction_jiuzhen_separatists",
		"3k_dlc06_faction_liaodong",
		"3k_dlc06_faction_liaodong_separatists",
		"3k_dlc06_faction_nanman_ahuinan",
		"3k_dlc06_faction_nanman_ahuinan_separatists",
		"3k_dlc06_faction_nanman_dongtuna",
		"3k_dlc06_faction_nanman_dongtuna_separatists",
		"3k_dlc06_faction_nanman_jiangyang",
		"3k_dlc06_faction_nanman_jiangyang_separatists",
		"3k_dlc06_faction_nanman_jianning",
		"3k_dlc06_faction_nanman_jianning_separatists",
		"3k_dlc06_faction_nanman_jiaozhi",
		"3k_dlc06_faction_nanman_jiaozhi_separatists",
		"3k_dlc06_faction_nanman_jinhuansanjie",
		"3k_dlc06_faction_nanman_jinhuansanjie_separatists",
		"3k_dlc06_faction_nanman_king_duosi",
		"3k_dlc06_faction_nanman_king_duosi_separatists",
		"3k_dlc06_faction_nanman_king_meng_huo",
		"3k_dlc06_faction_nanman_king_meng_huo_separatists",
		"3k_dlc06_faction_nanman_king_mulu",
		"3k_dlc06_faction_nanman_king_mulu_separatists",
		"3k_dlc06_faction_nanman_king_shamoke",
		"3k_dlc06_faction_nanman_king_shamoke_separatists",
		"3k_dlc06_faction_nanman_king_wutugu",
		"3k_dlc06_faction_nanman_king_wutugu_separatists",
		"3k_dlc06_faction_nanman_lady_zhurong",
		"3k_dlc06_faction_nanman_lady_zhurong_separatists",
		"3k_dlc06_faction_nanman_mangyachang",
		"3k_dlc06_faction_nanman_mangyachang_separatists",
		"3k_dlc06_faction_nanman_tu_an",
		"3k_dlc06_faction_nanman_tu_an_separatists",
		"3k_dlc06_faction_nanman_xi_ni",
		"3k_dlc06_faction_nanman_xi_ni_separatists",
		"3k_dlc06_faction_nanman_yang_feng",
		"3k_dlc06_faction_nanman_yang_feng_separatists",
		"3k_dlc06_faction_nanman_yongchang",
		"3k_dlc06_faction_nanman_yongchang_separatists",
		"3k_dlc06_faction_nanman_yunnan",
		"3k_dlc06_faction_nanman_yunnan_separatists",
		"3k_dlc06_faction_nanman_zangke",
		"3k_dlc06_faction_nanman_zangke_separatists",
		"3k_dlc06_faction_xiapi",
		"3k_dlc06_faction_xiapi_separatists",
		"3k_dlc06_faction_yongchang",
		"3k_dlc06_faction_yongchang_separatists",
		"3k_dlc06_faction_yunnan",
		"3k_dlc06_faction_yunnan_separatists"
	}

	--TECHNOLOGY DIPLOMACY RESTRICTIONS
	--METHODS OF UNIFICATION
	local methods_of_unification_key = "technology_required_proposer_methods_of_unification"
	local methods_of_unification_treaties = "treaty_components_region_offer,treaty_components_region_demand"
	--TRADE HUBS
	local trade_hubs_key = "technology_required_proposer_trade_hubs"
	local trade_hubs_treaties = "treaty_components_payment_regular_offer,treaty_components_payment_regular_demand,treaty_components_break_payment_regular_offer,treaty_components_break_payment_regular_demand"
	--TRADE HUBS OR METHODS OF UNIFICATION
	local methods_of_unification_or_trade_hubs_key = "technology_required_proposer_methods_of_unification_or_trade_hubs"
	local methods_of_unification_or_trade_hubs_treaties = "treaty_components_trade,treaty_components_military_access,treaty_components_non_aggression"
	--DEMAND FEALTY
	local demand_fealty_key = "technology_required_proposer_demand_fealty"
	local demand_fealty_treaties = "treaty_components_join_coalition_proposer,treaty_components_join_coalition_recipient,treaty_components_create_coalition,treaty_components_create_alliance,treaty_components_join_alliance_proposers,treaty_components_join_alliance_recipients"
	--DEMAND FEALTY OR CONTRACTUAL OBLIGATIONS
	local demand_fealty_or_contractual_obligations_key = "technology_required_proposer_demand_fealty_or_contractual_obligations"
	local demand_fealty_or_contractual_obligations_treaties = "treaty_components_annex_vassal"
	-- DIPLOMATC AUTHRITY OR PROVINCIAL INSPECTORS
	local diplomatic_authority_or_provincial_inspectors_key = "technology_required_proposer_diplomatic_authority_or_provincial_inspectors"
	local diplomatic_authority_or_provincial_inspectors_treaties = "treaty_components_join_empire_recipient,treaty_components_join_empire_proposer"

	--LIMIT NANMAN MERCENARY treaties with the proper restriction reason
	--CONTRACTUAL OBLIGATIONS
	local contractual_obligations_key = "technology_required_proposer_contractual_obligations"
	local contractual_obligations_recipient_treaties = "treaty_components_mercenary_contract_proposer_declares_war_against_target,treaty_components_mercenary_counter_contract_proposer_declares_war_against_target"
	local contractual_obligations_proposer_treaties = "treaty_components_mercenary_contract_recipient_declares_war_against_target,treaty_components_mercenary_counter_contract_recipient_declares_war_against_target"
	
	for _, v in pairs(nanman_major_and_minor_factions) do
		cm:modify_model():disable_diplomacy("subculture:3k_main_chinese","faction:"..v,contractual_obligations_proposer_treaties,"technology_required_recipient")
		cm:modify_model():disable_diplomacy("faction:"..v,"subculture:3k_main_chinese",contractual_obligations_recipient_treaties,contractual_obligations_key)
		cm:modify_model():disable_diplomacy("subculture:3k_dlc05_subculture_bandits","faction:"..v,contractual_obligations_proposer_treaties,"technology_required_recipient")
		cm:modify_model():disable_diplomacy("faction:"..v,"subculture:3k_dlc05_subculture_bandits",contractual_obligations_recipient_treaties,contractual_obligations_key)
		cm:modify_model():disable_diplomacy("subculture:3k_dlc06_subculture_nanman","faction:"..v,contractual_obligations_proposer_treaties,"technology_required_recipient")
		cm:modify_model():disable_diplomacy("faction:"..v,"subculture:3k_dlc06_subculture_nanman",contractual_obligations_recipient_treaties,contractual_obligations_key)
	end;

	-- Restricting Kong Rong from using his specific monopoly treaty to Nanman factions
	cm:modify_model():disable_diplomacy("faction:3k_main_faction_kong_rong", "subculture:3k_dlc06_subculture_nanman", "treaty_components_instigate_trade_monopoly", "methods_of_unification_or_trade_hubs_key")
	cm:modify_model():disable_diplomacy("subculture:3k_dlc06_subculture_nanman", "faction:3k_main_faction_kong_rong", "treaty_components_recieve_trade_monopoly", "methods_of_unification_or_trade_hubs_key")

	local non_nanman_treaty_availabilities = { 
		methods_of_unification_key,
		trade_hubs_key,
		methods_of_unification_or_trade_hubs_key,
		demand_fealty_key,
		demand_fealty_or_contractual_obligations_key,
		diplomatic_authority_or_provincial_inspectors_key
	};

	local non_nanman_treaty_availabilities_to_treaties_junction = { 
		[methods_of_unification_key]=methods_of_unification_treaties,
		[trade_hubs_key]=trade_hubs_treaties,
		[methods_of_unification_or_trade_hubs_key]=methods_of_unification_or_trade_hubs_treaties,
		[demand_fealty_key]=demand_fealty_treaties,
		[demand_fealty_or_contractual_obligations_key]=demand_fealty_or_contractual_obligations_treaties,
		[diplomatic_authority_or_provincial_inspectors_key]=diplomatic_authority_or_provincial_inspectors_treaties
	};

	for i = 1, #non_nanman_treaty_availabilities do
		local treaty_availability_reason = non_nanman_treaty_availabilities[i]
		if treaty_availability_reason ~= nil then
			local treaty_list = non_nanman_treaty_availabilities_to_treaties_junction[treaty_availability_reason]

			-- If treaty key is demanding fealty or contractual obligations, do the vassalige properly
			if treaty_availability_reason == demand_fealty_or_contractual_obligations_key then
				treaty_list = non_nanman_treaty_availabilities_to_treaties_junction[treaty_availability_reason]..",treaty_components_vassalise_proposer"
			end

			for _, v in pairs(nanman_major_and_minor_factions) do
				-- Restricting Han Chineses from being able to propose tech specific treaties to Nanman factions
				cm:modify_model():disable_diplomacy("subculture:3k_main_chinese", "faction:"..v, treaty_list, "technology_required_recipient")
				-- Restricting Yellow Turbans from being able to propose tech specific treaties to Nanman factions
				cm:modify_model():disable_diplomacy("subculture:3k_main_subculture_yellow_turban", "faction:"..v, treaty_list, "technology_required_recipient")
				-- Restricting Bandit factions from being able to propose tech specific treaties to Nanman factions
				cm:modify_model():disable_diplomacy("subculture:3k_dlc05_subculture_bandits", "faction:"..v, treaty_list, "technology_required_recipient")
			end;
			
			-- If treaty key is demanding fealty or contractual obligations, do the vassalige properly
			if treaty_availability_reason == demand_fealty_or_contractual_obligations_key then
				treaty_list = non_nanman_treaty_availabilities_to_treaties_junction[treaty_availability_reason]..",treaty_components_vassalise_recipient"
			end

			for _, v in pairs(nanman_major_and_minor_factions) do
				-- Restricting Nanman factions proposing tech specific treaties to Han Chinese
				cm:modify_model():disable_diplomacy("faction:"..v, "subculture:3k_main_chinese", treaty_list, ""..treaty_availability_reason.."")
				-- Restricting Nanman factions proposing tech specific treaties to Yellow Turbans
				cm:modify_model():disable_diplomacy("faction:"..v, "subculture:3k_main_subculture_yellow_turban", treaty_list, ""..treaty_availability_reason.."")
				-- Restricting Nanman factions proposing tech specific treaties to Bandit factions
				cm:modify_model():disable_diplomacy("faction:"..v, "subculture:3k_dlc05_subculture_bandits", treaty_list, ""..treaty_availability_reason.."")
			end;
		end
	end	
	
	--HIDDEN DIPLOMACY RESTRICTIONS
	
	local hidden_treaty_list = "treaty_components_confederate_proposer,treaty_components_marriage_recieve_male_female,treaty_components_marriage_recieve_male,treaty_components_marriage_recieve_female_male,treaty_components_marriage_recieve_female,treaty_components_marriage_give_male_female,treaty_components_marriage_give_male,treaty_components_marriage_give_female_male,treaty_components_marriage_give_female,treaty_components_marriage_confederate_recipient,treaty_components_marriage_confederate_proposer"
	
	-- Restricting Nanman factions from being able to propose confederation treaties (by any name) to Han Chinese
	cm:modify_model():disable_diplomacy("subculture:3k_dlc06_subculture_nanman", "subculture:3k_main_chinese", hidden_treaty_list..",treaty_components_vassalise_proposer_yellow_turban,treaty_components_vassalise_recipient_yellow_turban", "hidden")
	-- Restricting YHan Chineses from being able to propose confederation treaties (by any name) to Nanman
	cm:modify_model():disable_diplomacy("subculture:3k_main_chinese", "subculture:3k_dlc06_subculture_nanman", hidden_treaty_list..",treaty_components_abdicate_demand,treaty_components_abdicate_offer,treaty_components_vassalise_proposer_yellow_turban,treaty_components_vassalise_recipient_yellow_turban","hidden")
	-- Restricting Nanman factions from being able to propose confederation treaties (by any name) to Yellow Turbans
	cm:modify_model():disable_diplomacy("subculture:3k_dlc06_subculture_nanman", "subculture:3k_main_subculture_yellow_turban", hidden_treaty_list, "hidden")
	-- Restricting Yellow Turbans from being able to propose confederation treaties (by any name) to Nanman factions
	cm:modify_model():disable_diplomacy("subculture:3k_main_subculture_yellow_turban", "subculture:3k_dlc06_subculture_nanman", hidden_treaty_list..",treaty_components_abdicate_demand,treaty_components_abdicate_offer", "hidden")
	-- Restricting Nanman factions from being able to propose confederation treaties (by any name) to bandit factions
	cm:modify_model():disable_diplomacy("subculture:3k_dlc06_subculture_nanman", "subculture:3k_dlc05_subculture_bandits", hidden_treaty_list..",treaty_components_vassalise_proposer_yellow_turban,treaty_components_vassalise_recipient_yellow_turban", "hidden")
	-- Restricting bandit factions from being able to propose confederation treaties (by any name) to Nanman factions
	cm:modify_model():disable_diplomacy("subculture:3k_dlc05_subculture_bandits", "subculture:3k_dlc06_subculture_nanman", hidden_treaty_list..",treaty_components_abdicate_demand,treaty_components_abdicate_offer,treaty_components_vassalise_proposer_yellow_turban,treaty_components_vassalise_recipient_yellow_turban", "hidden")

	--YELLOW TURBAN DIPLOMACY RESTRICTIONS

	--Restricting Yellow Turbans from using their cross-culture vassalage with Nanman until progression rank is reached
	cm:modify_model():disable_diplomacy("subculture:3k_main_subculture_yellow_turban", "subculture:3k_dlc06_subculture_nanman", "treaty_components_vassalise_recipient_yellow_turban", "hidden")
	--Restricting Nanman factions from offering to become vassals of Yellow Turbans based on Yellow Turban progression rank
    cm:modify_model():disable_diplomacy("subculture:3k_dlc06_subculture_nanman", "subculture:3k_main_subculture_yellow_turban", "treaty_components_vassalise_proposer,treaty_components_vassalise_recipient_yellow_turban", "hidden")
    --Restricting Nanman factions from using non-Yellow Turban specific vassalage between themselves
    cm:modify_model():disable_diplomacy("subculture:3k_dlc06_subculture_nanman","subculture:3k_dlc06_subculture_nanman", "treaty_components_vassalise_proposer_yellow_turban,treaty_components_vassalise_recipient_yellow_turban", "hidden")
	--Restricting Yellow Turban factions from using non-Yellow Turban specific vassalage treaty when negotiating vassalage with Nanman facions
	cm:modify_model():disable_diplomacy("subculture:3k_main_subculture_yellow_turban", "subculture:3k_dlc06_subculture_nanman", "treaty_components_annex_vassal,treaty_components_declare_independence,treaty_components_vassalise_proposer,treaty_components_vassalise_recipient,treaty_components_vassalise_proposer_yellow_turban,treaty_components_vassalise_recipient_yellow_turban,treaty_components_offer_autonomy,treaty_components_demand_autonomy,treaty_components_vassal_requests_war,treaty_components_draw_vassal_into_war,treaty_components_vassal_joins_war,treaty_components_liberate_proposer,treaty_components_liberate_recipient", "hidden")
	--Restricting Yellow Turbans from using their cross-culture vassalage with Nanman until progression rank is reached
	cm:modify_model():disable_diplomacy("subculture:3k_main_subculture_yellow_turban", "subculture:3k_dlc06_subculture_nanman", "treaty_components_break_deal_proposer_to_recipient_unilateral,treaty_components_create_alliance,treaty_components_food_supply_demand,treaty_components_food_supply_offer,treaty_components_alliance_to_alliance_group_peace,treaty_components_alliance_to_faction_group_peace,treaty_components_faction_to_alliance_group_peace,treaty_components_group_war,treaty_components_join_alliance_proposers,treaty_components_join_alliance_recipients,treaty_components_join_coalition_proposer,treaty_components_join_coalition_recipient,treaty_components_military_access,treaty_components_non_aggression,treaty_components_create_coalition", "yellow_turban_rank_requirement_proposer")
	--Restricting Nanman factions from using non-Yellow Turban specific vassalage treaty when negotiating vassalage with Yellow Turbans
	cm:modify_model():disable_diplomacy("subculture:3k_dlc06_subculture_nanman", "subculture:3k_main_subculture_yellow_turban", "treaty_components_annex_vassal,treaty_components_declare_independence,treaty_components_vassalise_proposer,treaty_components_vassalise_recipient,treaty_components_vassalise_proposer_yellow_turban,treaty_components_vassalise_recipient_yellow_turban,treaty_components_offer_autonomy,treaty_components_demand_autonomy,treaty_components_vassal_requests_war,treaty_components_draw_vassal_into_war,treaty_components_vassal_joins_war,treaty_components_liberate_proposer,treaty_components_liberate_recipient", "hidden")
	--Restricting Nanman factions from offering to become vassals of Yellow Turbans based on Yellow Turban progression rank
	cm:modify_model():disable_diplomacy("subculture:3k_dlc06_subculture_nanman", "subculture:3k_main_subculture_yellow_turban", "treaty_components_break_deal_proposer_to_recipient_unilateral,treaty_components_confederate_proposer,treaty_components_confederate_recipient,treaty_components_create_alliance,treaty_components_food_supply_demand,treaty_components_food_supply_offer,treaty_components_alliance_to_alliance_group_peace,treaty_components_alliance_to_faction_group_peace,treaty_components_faction_to_alliance_group_peace,treaty_components_group_war,treaty_components_join_alliance_proposers,treaty_components_join_alliance_recipients,treaty_components_join_coalition_proposer,treaty_components_join_coalition_recipient,treaty_components_military_access,treaty_components_non_aggression,treaty_components_create_coalition", "yellow_turban_rank_requirement_recipient")

	-- Prevent nanman having emperor treaties visible in the UI.
	local nanman_prohibited_imperial_treaties = "treaty_components_abdicate_offer,treaty_components_abdicate_demand";
	cm:modify_model():disable_diplomacy("faction:3k_dlc06_faction_nanman_king_meng_huo", "all", nanman_prohibited_imperial_treaties, "hidden");
	cm:modify_model():disable_diplomacy("faction:3k_dlc06_faction_nanman_king_mulu", "all", nanman_prohibited_imperial_treaties, "hidden");
	cm:modify_model():disable_diplomacy("faction:3k_dlc06_faction_nanman_lady_zhurong", "all", nanman_prohibited_imperial_treaties, "hidden");
end;

--Function: enable_diplomacy
--Description: Enable factions being able to propose diplomatic treaty components to other factions with a reason. Filters can contain comma separated elements. Valid elements are "all", --"faction:faction_key", "subculture:subculture_key" and "culture:culture_key". component_keys is a comma separated list of campaign_diplomacy_treaty_component keys. reason_key is a key from the --campaign_diplomacy_treaty_availability_reasons table.
--Parameters: (String proposer_filter, String recipient_filter, String component_keys, String reason_key)
--Return: (void)

function apply_default_diplomatic_availability()
	------------------------------------------------------
	----------------------- 3K MAIN ----------------------
	------ Enable 3k_Main Faction Specific Treaties ------
	-------------------- For Factions --------------------
	------------------------------------------------------
	out("* applying 3K Main faction specific treaty availability");

	cm:modify_model():enable_diplomacy("faction:3k_main_faction_cao_cao", "subculture:3k_main_chinese", "treaty_components_attitude_manipulation_positive,treaty_components_attitude_manipulation_negative,treaty_components_instigate_proxy_war_proposer,treaty_components_schemes_resource_offer", "hidden")
	cm:modify_model():enable_diplomacy("faction:3k_main_faction_dong_zhuo", "subculture:3k_main_chinese", "treaty_components_coercion", "hidden")
	cm:modify_model():enable_diplomacy("faction:3k_main_faction_zheng_jiang", "subculture:3k_main_chinese", "treaty_components_tribute_demand", "hidden")
	cm:modify_model():enable_diplomacy("subculture:3k_main_chinese", "faction:3k_main_faction_zheng_jiang", "treaty_components_tribute_offer", "hidden")
	cm:modify_model():enable_diplomacy("faction:3k_main_faction_yuan_shao", "subculture:3k_main_chinese", "treaty_components_create_alliance_yuan_shao,treaty_components_create_coalition_yuan_shao,treaty_components_coalition_to_alliance_yuan_shao,treaty_components_create_empire_yuan_shao,treaty_components_alliance_to_empire_yuan_shao,treaty_components_coalition_to_empire_yuan_shao", "hidden")
	cm:modify_model():enable_diplomacy("subculture:3k_main_chinese", "faction:3k_main_faction_yuan_shao", "treaty_components_create_alliance_yuan_shao_counter_offer,treaty_components_create_coalition_yuan_shao_counter_offer,treaty_components_create_empire_yuan_shao_counter_offer", "hidden")
	cm:modify_model():enable_diplomacy("faction:3k_main_faction_yuan_shu", "subculture:3k_main_chinese", "treaty_components_acknowledge_legitimacy_demand,treaty_components_create_alliance_yuan_shu,treaty_components_create_coalition_yuan_shu,treaty_components_coalition_to_alliance_yuan_shu,treaty_components_vassalise_recipient_yuan_shu", "hidden")
	cm:modify_model():enable_diplomacy("subculture:3k_main_chinese", "faction:3k_main_faction_yuan_shu", "treaty_components_create_alliance_yuan_shu_counter_offer,treaty_components_create_coalition_yuan_shu_counter_offer,treaty_components_vassalise_proposer_yuan_shu,treaty_components_acknowledge_legitimacy_offer", "hidden")
	cm:modify_model():enable_diplomacy("faction:3k_main_faction_kong_rong", "subculture:3k_main_chinese", "treaty_components_instigate_trade_monopoly", "hidden")
	cm:modify_model():enable_diplomacy("subculture:3k_main_chinese", "faction:3k_main_faction_kong_rong", "treaty_components_recieve_trade_monopoly", "hidden")
	cm:modify_model():enable_diplomacy("faction:3k_main_faction_liu_bei", "subculture:3k_main_chinese", "treaty_components_liu_bei_confederate_recipient", "hidden")
	cm:modify_model():enable_diplomacy("subculture:3k_main_chinese", "faction:3k_main_faction_liu_bei", "treaty_components_liu_bei_confederate_proposer", "hidden")

	-----------------------------------------------------
	---------------------- 3K Main ----------------------
	----- Disable 3k_Main Faction Specific Treaties -----
	------ Which Were Enabled Through Culture -----------
	-----------------------------------------------------
	cm:modify_model():disable_diplomacy("faction:3k_main_faction_cao_cao", "all","treaty_components_instigate_proxy_war_recipient", "hidden")
	cm:modify_model():disable_diplomacy("faction:3k_main_faction_yuan_shu", "all","treaty_components_create_alliance_yuan_shu_counter_offer,treaty_components_create_coalition_yuan_shu_counter_offer", "hidden")
	cm:modify_model():disable_diplomacy("faction:3k_main_faction_yuan_shao", "all","treaty_components_create_alliance_yuan_shao_counter_offer,treaty_components_create_coalition_yuan_shao_counter_offer,treaty_components_create_empire_yuan_shao_counter_offer", "hidden")
	cm:modify_model():disable_diplomacy("faction:3k_main_faction_liu_bei", "all", "treaty_components_liu_bei_confederate_proposer", "hidden")
end;


function apply_DLC04_diplomatic_availability()
	------------------------------------------------------
	----------------------- 3K DCL04----------------------
	------ Enable 3k_Main Faction Specific Treaties ------
	-------------------- For Factions --------------------
	------------------------------------------------------	
	out("* applying 3K DLC04 faction specific treaty availability");

	cm:modify_model():enable_diplomacy("faction:3k_main_faction_liu_biao", "all", "treaty_components_vassalise_recipient_liu_biao", "hidden")
	cm:modify_model():enable_diplomacy("all", "faction:3k_main_faction_liu_biao", "treaty_components_vassalise_proposer_liu_biao", "hidden")
end;


function apply_DLC05_diplomatic_availability()
	------------------------------------------------------
	---------------------- 3K DLC05 ----------------------
	----- Enable 3K_LDC05 Faction Specific Treaties ------
	--------------------- For Factions -------------------
	------------------------------------------------------	
	out("* applying 3K DLC05 faction specific treaty availability");
	cm:modify_model():enable_diplomacy("faction:3k_main_faction_cao_cao", "subculture:3k_dlc05_subculture_bandits", "treaty_components_attitude_manipulation_positive,treaty_components_attitude_manipulation_negative,treaty_components_instigate_proxy_war_proposer", "hidden")
	cm:modify_model():enable_diplomacy("faction:3k_main_faction_dong_zhuo", "subculture:3k_dlc05_subculture_bandits", "treaty_components_coercion", "hidden")
	cm:modify_model():enable_diplomacy("faction:3k_main_faction_zheng_jiang", "subculture:3k_dlc05_subculture_bandits", "treaty_components_tribute_demand", "hidden")
	cm:modify_model():enable_diplomacy("subculture:3k_dlc05_subculture_bandits", "faction:3k_main_faction_zheng_jiang", "treaty_components_tribute_offer", "hidden")
	cm:modify_model():enable_diplomacy("faction:3k_main_faction_yuan_shao", "subculture:3k_dlc05_subculture_bandits", "treaty_components_create_alliance_yuan_shao,treaty_components_create_coalition_yuan_shao,treaty_components_coalition_to_alliance_yuan_shao,treaty_components_create_empire_yuan_shao,treaty_components_alliance_to_empire_yuan_shao,treaty_components_coalition_to_empire_yuan_shao", "hidden")
	cm:modify_model():enable_diplomacy("subculture:3k_dlc05_subculture_bandits", "faction:3k_main_faction_yuan_shao", "treaty_components_create_alliance_yuan_shao_counter_offer,treaty_components_create_coalition_yuan_shao_counter_offer,treaty_components_create_empire_yuan_shao_counter_offer", "hidden")
	cm:modify_model():enable_diplomacy("faction:3k_main_faction_yuan_shu", "subculture:3k_dlc05_subculture_bandits", "treaty_components_acknowledge_legitimacy_demand,treaty_components_create_alliance_yuan_shu,treaty_components_create_coalition_yuan_shu,treaty_components_coalition_to_alliance_yuan_shu,treaty_components_vassalise_recipient_yuan_shu", "hidden")
	cm:modify_model():enable_diplomacy("subculture:3k_dlc05_subculture_bandits", "faction:3k_main_faction_yuan_shu", "treaty_components_create_alliance_yuan_shu_counter_offer,treaty_components_create_coalition_yuan_shu_counter_offer,treaty_components_vassalise_proposer_yuan_shu,treaty_components_acknowledge_legitimacy_offer", "hidden")
	cm:modify_model():enable_diplomacy("faction:3k_main_faction_kong_rong", "subculture:3k_dlc05_subculture_bandits", "treaty_components_instigate_trade_monopoly", "hidden")
	cm:modify_model():enable_diplomacy("subculture:3k_dlc05_subculture_bandits", "faction:3k_main_faction_kong_rong", "treaty_components_recieve_trade_monopoly", "hidden")
	cm:modify_model():enable_diplomacy("faction:3k_dlc05_faction_white_tiger_yan", "subculture:3k_main_chinese","treaty_components_create_alliance_white_tiger,treaty_components_create_coalition_white_tiger,treaty_components_coalition_to_alliance_white_tiger,treaty_components_create_empire_white_tiger,treaty_components_alliance_to_empire_white_tiger", "hidden")
	cm:modify_model():enable_diplomacy("faction:3k_dlc05_faction_white_tiger_yan", "subculture:3k_dlc05_subculture_bandits", "treaty_components_create_alliance_white_tiger,treaty_components_create_coalition_white_tiger,treaty_components_coalition_to_alliance_white_tiger,treaty_components_create_empire_white_tiger,treaty_components_coalition_to_empire_white_tiger,treaty_components_alliance_to_empire_white_tiger", "hidden")
	cm:modify_model():enable_diplomacy("subculture:3k_main_chinese","faction:3k_dlc05_faction_white_tiger_yan", "treaty_components_create_empire_white_tiger_counter_offer,treaty_components_create_alliance_white_tiger_counter_offer,treaty_components_create_coalition_white_tiger_counter_offer", "hidden")
	cm:modify_model():enable_diplomacy("subculture:3k_dlc05_subculture_bandits","faction:3k_dlc05_faction_white_tiger_yan","treaty_components_create_empire_white_tiger_counter_offer,treaty_components_create_alliance_white_tiger_counter_offer,treaty_components_create_coalition_white_tiger_counter_offer", "hidden")
	
	------------------------------------------------------
	---------------------- 3K DLC05 ----------------------
	------ Enable 3k_Main Culture Specific Treaties ------
	-------------------- For Cultures --------------------
	------------------------------------------------------
	--cm:modify_model():enable_diplomacy("all","subculture:3k_dlc05_subculture_bandits","treaty_components_mercenary_contract_proposer_declares_war_against_target,treaty_components_mercenary_contract_recipient_declares_war_against_target","hidden")
end;

function apply_DLC06_diplomatic_availability()
	------------------------------------------------------
	---------------------- 3K DLC06 ----------------------
	----- Enable 3K_LDC06 Faction Specific Treaties ------
	--------------------- For Factions -------------------
	------------------------------------------------------	
	out("* applying 3K DLC05 faction specific treaty availability");
	cm:modify_model():enable_diplomacy("faction:3k_main_faction_cao_cao", "subculture:3k_dlc06_subculture_nanman", "treaty_components_attitude_manipulation_positive,treaty_components_attitude_manipulation_negative,treaty_components_instigate_proxy_war_proposer", "hidden")
	cm:modify_model():enable_diplomacy("faction:3k_main_faction_dong_zhuo", "subculture:3k_dlc06_subculture_nanman", "treaty_components_coercion", "hidden")
	cm:modify_model():enable_diplomacy("faction:3k_main_faction_zheng_jiang", "subculture:3k_dlc06_subculture_nanman", "treaty_components_tribute_demand", "hidden")
	cm:modify_model():enable_diplomacy("subculture:3k_dlc06_subculture_nanman", "faction:3k_main_faction_zheng_jiang", "treaty_components_tribute_offer", "hidden")
	cm:modify_model():enable_diplomacy("faction:3k_main_faction_yuan_shu", "subculture:3k_dlc06_subculture_nanman", "treaty_components_acknowledge_legitimacy_demand", "hidden")
	cm:modify_model():enable_diplomacy("subculture:3k_dlc06_subculture_nanman", "faction:3k_main_faction_yuan_shu", "treaty_components_acknowledge_legitimacy_offer", "hidden")
	--PROHIPT CAO CAO FROM POSITIVELY/NEGATIVELY MANIPULATING THE OPNION TOWARDS OTHER FACTIONS
	if cm:query_faction("3k_main_faction_cao_cao"):is_human() then
		local human_factions = cm:get_human_factions();	
		for i = 1, #human_factions do
			if human_factions[i] ~= nil and cm:query_faction(human_factions[i]):subculture() == "3k_dlc06_subculture_nanman" then
				cm:modify_model():disable_diplomacy("faction:3k_main_faction_cao_cao","faction:"..human_factions[i],"treaty_components_attitude_manipulation_positive,treaty_components_attitude_manipulation_negative","hidden")
			end
		end
	end
end;


function start_faction_to_building_diplomatic_restriction_monitors()
	-----------------------------------------------------
	---------------------- 3K Main ----------------------
	------ Enable Zhang Yan Access To Treaties With -----
	-- Yellow Turban Factions Based on Infrastructure ---
	-----------------------------------------------------
	output("start_faction_to_building_diplomatic_restriction_monitors() begin");

	start_faction_to_building_diplomatic_restriction_monitor(
		"3k_main_faction_zhang_yan",
		{
			-- "3k_district_government_administration_black_mountain_1",		-- for test purposes
			"3k_district_government_administration_black_mountain_refuge_3",
			"3k_district_government_administration_black_mountain_refuge_4",
			"3k_district_government_administration_black_mountain_refuge_5"
		},
		function()
			-- no building callback
			output("start_faction_to_building_diplomatic_restriction_monitors() disabling diplomacy between 3k_main_faction_zhang_yan and 3k_main_subculture_yellow_turban");
			cm:modify_model():disable_diplomacy("subculture:3k_main_subculture_yellow_turban", "faction:3k_main_faction_zhang_yan", "treaty_components_create_empire,treaty_components_join_empire_proposer,treaty_components_join_empire_recipient,treaty_components_alliance_democratic,treaty_components_alliance_to_alliance_war,treaty_components_alliance_to_faction_war,treaty_components_ancillary_demand,treaty_components_ancillary_offer,treaty_components_annex_vassal,treaty_components_break_deal_proposer_to_recipient_unilateral,treaty_components_confederate_proposer,treaty_components_confederate_recipient,treaty_components_create_alliance,treaty_components_declare_independence,treaty_components_draw_vassal_into_war,treaty_components_faction_to_alliance_war,treaty_components_food_supply_demand,treaty_components_food_supply_offer,treaty_components_alliance_to_alliance_group_peace,treaty_components_alliance_to_faction_group_peace,treaty_components_faction_to_alliance_group_peace,treaty_components_group_war,treaty_components_guarentee_autonomy,treaty_components_join_alliance_proposers,treaty_components_join_alliance_recipients,treaty_components_join_coalition_proposer,treaty_components_join_coalition_recipient,treaty_components_liberate_proposer,treaty_components_liberate_recipient,treaty_components_military_access,treaty_components_non_aggression,treaty_components_payment_demand,treaty_components_payment_offer,treaty_components_payment_regular_demand,treaty_components_payment_regular_offer,treaty_components_peace,treaty_components_proposer_declares_war_against_target,treaty_components_recipient_declares_war_against_target,treaty_components_region_demand,treaty_components_region_offer,treaty_components_threaten,treaty_components_trade,treaty_components_vassalise_proposer,treaty_components_vassalise_recipient,treaty_components_call_vassals_to_arms,treaty_components_create_coalition,treaty_components_offer_autonomy,treaty_components_demand_autonomy,treaty_components_vassal_requests_war,treaty_components_vassal_joins_war", "recipient_black_mountain_refuge_not")
			cm:modify_model():disable_diplomacy("faction:3k_main_faction_zhang_yan", "subculture:3k_main_subculture_yellow_turban", "treaty_components_create_empire,treaty_components_join_empire_proposer,treaty_components_join_empire_recipient,treaty_components_alliance_democratic,treaty_components_alliance_to_alliance_war,treaty_components_alliance_to_faction_war,treaty_components_ancillary_demand,treaty_components_ancillary_offer,treaty_components_annex_vassal,treaty_components_break_deal_proposer_to_recipient_unilateral,treaty_components_confederate_proposer,treaty_components_confederate_recipient,treaty_components_create_alliance,treaty_components_declare_independence,treaty_components_draw_vassal_into_war,treaty_components_faction_to_alliance_war,treaty_components_food_supply_demand,treaty_components_food_supply_offer,treaty_components_alliance_to_alliance_group_peace,treaty_components_alliance_to_faction_group_peace,treaty_components_faction_to_alliance_group_peace,treaty_components_group_war,treaty_components_guarentee_autonomy,treaty_components_join_alliance_proposers,treaty_components_join_alliance_recipients,treaty_components_join_coalition_proposer,treaty_components_join_coalition_recipient,treaty_components_liberate_proposer,treaty_components_liberate_recipient,treaty_components_military_access,treaty_components_non_aggression,treaty_components_payment_demand,treaty_components_payment_offer,treaty_components_payment_regular_demand,treaty_components_payment_regular_offer,treaty_components_peace,treaty_components_proposer_declares_war_against_target,treaty_components_recipient_declares_war_against_target,treaty_components_region_demand,treaty_components_region_offer,treaty_components_threaten,treaty_components_trade,treaty_components_vassalise_proposer,treaty_components_vassalise_recipient,treaty_components_call_vassals_to_arms,treaty_components_create_coalition,treaty_components_offer_autonomy,treaty_components_demand_autonomy,treaty_components_vassal_requests_war,treaty_components_vassal_joins_war", "proposer_black_mountain_refuge_not")			
		end,
		function()
			-- has building callback
			output("start_faction_to_building_diplomatic_restriction_monitors() enabling diplomacy between 3k_main_faction_zhang_yan and 3k_main_subculture_yellow_turban");
			cm:modify_model():enable_diplomacy("subculture:3k_main_subculture_yellow_turban", "faction:3k_main_faction_zhang_yan", "treaty_components_create_empire,treaty_components_join_empire_proposer,treaty_components_join_empire_recipient,treaty_components_alliance_democratic,treaty_components_alliance_to_alliance_war,treaty_components_alliance_to_faction_war,treaty_components_ancillary_demand,treaty_components_ancillary_offer,treaty_components_annex_vassal,treaty_components_break_deal_proposer_to_recipient_unilateral,treaty_components_confederate_proposer,treaty_components_confederate_recipient,treaty_components_create_alliance,treaty_components_declare_independence,treaty_components_draw_vassal_into_war,treaty_components_faction_to_alliance_war,treaty_components_food_supply_demand,treaty_components_food_supply_offer,treaty_components_alliance_to_alliance_group_peace,treaty_components_alliance_to_faction_group_peace,treaty_components_faction_to_alliance_group_peace,treaty_components_group_war,treaty_components_guarentee_autonomy,treaty_components_join_alliance_proposers,treaty_components_join_alliance_recipients,treaty_components_join_coalition_proposer,treaty_components_join_coalition_recipient,treaty_components_liberate_proposer,treaty_components_liberate_recipient,treaty_components_military_access,treaty_components_non_aggression,treaty_components_payment_demand,treaty_components_payment_offer,treaty_components_payment_regular_demand,treaty_components_payment_regular_offer,treaty_components_peace,treaty_components_proposer_declares_war_against_target,treaty_components_recipient_declares_war_against_target,treaty_components_region_demand,treaty_components_region_offer,treaty_components_threaten,treaty_components_trade,treaty_components_vassalise_proposer,treaty_components_vassalise_recipient,treaty_components_call_vassals_to_arms,treaty_components_create_coalition,treaty_components_offer_autonomy,treaty_components_demand_autonomy,treaty_components_vassal_requests_war,treaty_components_vassal_joins_war", "recipient_black_mountain_refuge_not")
			cm:modify_model():enable_diplomacy("faction:3k_main_faction_zhang_yan", "subculture:3k_main_subculture_yellow_turban", "treaty_components_create_empire,treaty_components_join_empire_proposer,treaty_components_join_empire_recipient,treaty_components_alliance_democratic,treaty_components_alliance_to_alliance_war,treaty_components_alliance_to_faction_war,treaty_components_ancillary_demand,treaty_components_ancillary_offer,treaty_components_annex_vassal,treaty_components_break_deal_proposer_to_recipient_unilateral,treaty_components_confederate_proposer,treaty_components_confederate_recipient,treaty_components_create_alliance,treaty_components_declare_independence,treaty_components_draw_vassal_into_war,treaty_components_faction_to_alliance_war,treaty_components_food_supply_demand,treaty_components_food_supply_offer,treaty_components_alliance_to_alliance_group_peace,treaty_components_alliance_to_faction_group_peace,treaty_components_faction_to_alliance_group_peace,treaty_components_group_war,treaty_components_guarentee_autonomy,treaty_components_join_alliance_proposers,treaty_components_join_alliance_recipients,treaty_components_join_coalition_proposer,treaty_components_join_coalition_recipient,treaty_components_liberate_proposer,treaty_components_liberate_recipient,treaty_components_military_access,treaty_components_non_aggression,treaty_components_payment_demand,treaty_components_payment_offer,treaty_components_payment_regular_demand,treaty_components_payment_regular_offer,treaty_components_peace,treaty_components_proposer_declares_war_against_target,treaty_components_recipient_declares_war_against_target,treaty_components_region_demand,treaty_components_region_offer,treaty_components_threaten,treaty_components_trade,treaty_components_vassalise_proposer,treaty_components_vassalise_recipient,treaty_components_call_vassals_to_arms,treaty_components_create_coalition,treaty_components_offer_autonomy,treaty_components_demand_autonomy,treaty_components_vassal_requests_war,treaty_components_vassal_joins_war", "proposer_black_mountain_refuge_not")
		end
	);
	output("start_faction_to_building_diplomatic_restriction_monitors() end");
end;


function start_faction_to_building_diplomatic_restriction_monitor(faction_key, building_list, no_building_callback, has_building_callback)

	-- check inputs
	if not is_string(faction_key) then
		script_error("ERROR: start_faction_to_building_diplomatic_restriction_monitor() called but supplied faction key [" .. tostring(faction_key) .. "] is not a string");
		return false;
	end;
	
	if not is_table(building_list) then
		script_error("ERROR: start_faction_to_building_diplomatic_restriction_monitor() called but supplied building list [" .. tostring(building_list) .. "] is not a table");
		return false;
	end;
	
	if #building_list == 0 then
		script_error("ERROR: start_faction_to_building_diplomatic_restriction_monitor() called but supplied building list [" .. tostring(building_list) .. "] is empty");
		return false;
	end;
	
	for i = 1, #building_list do
		if not is_string(building_list[i]) then
			script_error("ERROR: start_faction_to_building_diplomatic_restriction_monitor() called but element " .. i .. " in supplied building list is not a string, its value is [" .. tostring(building_list[i]) .. "]");
			return false;
		end;
	end;
	
	if not is_function(no_building_callback) then
		script_error("ERROR: start_faction_to_building_diplomatic_restriction_monitor() called but supplied no-building callback [" .. tostring(no_building_callback) .. "] is not a function");
		return false;
	end;
	
	if not is_function(has_building_callback) then
		script_error("ERROR: start_faction_to_building_diplomatic_restriction_monitor() called but supplied has-building callback [" .. tostring(has_building_callback) .. "] is not a function");
		return false;
	end;
	
	local faction_has_building_saved_value_key = "faction_to_building_has_building_restriction_" .. faction_key;
	local listener_name = faction_has_building_saved_value_key;
	
	-- construct a check function which returns true if the supplied faction contains any of the supplied buildings
	local function faction_contains_building_check()
		local faction = cm:query_faction(faction_key);
		for i = 1, #building_list do
			output("start_faction_to_building_diplomatic_restriction_monitors() element " .. i .. " in supplied building list of [" .. tostring(faction_key) .. "] is [" .. tostring(building_list[i]) .. "]");
			if faction_contains_building(faction, building_list[i]) then
				output("start_faction_to_building_diplomatic_restriction_monitors() element [" .. tostring(building_list[i]) .. "] exists");
				return true;
			end;
		end;
		output("start_faction_to_building_diplomatic_restriction_monitors() none of the elements in the supplied building list exists in the faction of [" .. tostring(faction_key) .. "]");
		return false;
	end;
	
	-- Construct a function which applies or un-applies the diplomatic restriction based on the result of faction_contains_building_check() and the current restriction state.
	-- This is what should be called when the restriction state needs to be re-assessed.
	local function update_restriction_check()
		if cm:get_saved_value(faction_has_building_saved_value_key) then
			if not faction_contains_building_check() then
				-- has_building restriction is applied but the faction contains none of the supplied buildings, so lift that restriction
				out("* start_faction_to_building_diplomatic_restriction_monitor() is calling supplied no_building_callback as faction " .. tostring(faction_key) .. " contains none of the supplied buildings [" .. table.concat(building_list, ", ") .. "]");
				cm:set_saved_value(faction_has_building_saved_value_key, false);
				no_building_callback();
			end;
		else
			if faction_contains_building_check() then
				-- has_building restriction is not applied and the faction contains one or more of the supplied buildings, so apply the restriction
				out("* start_faction_to_building_diplomatic_restriction_monitor() is calling supplied has_building_callback as faction " .. tostring(faction_key) .. " contains one of the supplied buildings [" .. table.concat(building_list, ", ") .. "]");
				cm:set_saved_value(faction_has_building_saved_value_key, true);
				has_building_callback();
			end;
		end;
	end;
	
	-- run the check function immediately if this is a new game
	if cm:is_new_game() then
		update_restriction_check();
	end;
	
	-- run the check function when the subject faction starts its turn
	core:add_listener(
		listener_name,
		"FactionTurnStart",
		function(context) return context:faction():name() == faction_key end,
		function(context)
			update_restriction_check();
		end,
		true
	);
	
	-- run the check function when the subject faction completes a building
	core:add_listener(
		listener_name,
		"BuildingCompleted",
		function(context) return context:garrison_residence():faction():name() == faction_key end,
		function(context)
			update_restriction_check();
		end,
		true
	);
	
	-- run the check function when a battle is completed on the players turn
	core:add_listener(
		listener_name,
		"GarrisonOccupiedEvent",
		function(context) return context:query_model():world():whose_turn_is_it():name() == faction_key end,
		function(context)
			update_restriction_check();
		end,
		true	
	);
end;


function stop_faction_to_building_diplomatic_restriction_monitor(faction_key)
	core:remove_listener("faction_to_building_has_building_restriction_" .. faction_key);
end;


function start_yt_faction_progression_listeners()
	-----------------------------------------------------
	--------------------- 3K DCL01 ----------------------
	---- Enable Diplomacy For Yellow Turban Factions ----
	--- To Other Cultures Based on Progression Level ----
	-----------------------------------------------------
	out("* Starting Yellow Turban faction progression listeners");

	-- define a list of participating factions
	local eligible_faction_list = {
		"3k_main_faction_yellow_turban_anding",
		"3k_main_faction_yellow_turban_rebels",
		"3k_main_faction_yellow_turban_generic"
	}
	
	local progression_level_to_action_mapping = {
		{
			progression_level = 2,
			action = function(faction_key)
				cm:modify_model():enable_diplomacy("faction:"..faction_key, "subculture:3k_main_chinese", "treaty_components_peace,treaty_components_alliance_to_alliance_group_peace,treaty_components_alliance_to_faction_group_peace,treaty_components_faction_to_alliance_group_peace,treaty_components_threaten,treaty_components_faction_to_alliance_war,treaty_components_alliance_to_alliance_war,treaty_components_alliance_to_faction_war,treaty_components_coercion,treaty_components_call_vassals_to_arms,treaty_components_group_war,treaty_components_proposer_declares_war_against_target,treaty_components_recipient_declares_war_against_target,treaty_components_region_demand,treaty_components_region_offer,treaty_components_payment_demand,treaty_components_payment_offer,treaty_components_payment_regular_demand,treaty_components_payment_regular_offer,treaty_components_ancillary_demand,treaty_components_ancillary_offer", "yellow_turban_rank_requirement_proposer")
				cm:modify_model():enable_diplomacy("subculture:3k_main_chinese", "faction:"..faction_key, "treaty_components_peace,treaty_components_alliance_to_alliance_group_peace,treaty_components_alliance_to_faction_group_peace,treaty_components_faction_to_alliance_group_peace,treaty_components_threaten,treaty_components_faction_to_alliance_war,treaty_components_alliance_to_alliance_war,treaty_components_alliance_to_faction_war,treaty_components_coercion,treaty_components_call_vassals_to_arms,treaty_components_group_war,treaty_components_proposer_declares_war_against_target,treaty_components_recipient_declares_war_against_target,treaty_components_region_demand,treaty_components_region_offer,treaty_components_payment_demand,treaty_components_payment_offer,treaty_components_payment_regular_demand,treaty_components_payment_regular_offer,treaty_components_ancillary_demand,treaty_components_ancillary_offer", "yellow_turban_rank_requirement_recipient")
				cm:modify_model():enable_diplomacy("faction:"..faction_key, "subculture:3k_dlc05_subculture_bandits", "treaty_components_peace,treaty_components_alliance_to_alliance_group_peace,treaty_components_alliance_to_faction_group_peace,treaty_components_faction_to_alliance_group_peace,treaty_components_threaten,treaty_components_faction_to_alliance_war,treaty_components_alliance_to_alliance_war,treaty_components_alliance_to_faction_war,treaty_components_coercion,treaty_components_call_vassals_to_arms,treaty_components_group_war,treaty_components_proposer_declares_war_against_target,treaty_components_recipient_declares_war_against_target,treaty_components_region_demand,treaty_components_region_offer,treaty_components_payment_demand,treaty_components_payment_offer,treaty_components_payment_regular_demand,treaty_components_payment_regular_offer,treaty_components_ancillary_demand,treaty_components_ancillary_offer", "yellow_turban_rank_requirement_proposer")
				cm:modify_model():enable_diplomacy("subculture:3k_dlc05_subculture_bandits", "faction:"..faction_key, "treaty_components_peace,treaty_components_alliance_to_alliance_group_peace,treaty_components_alliance_to_faction_group_peace,treaty_components_faction_to_alliance_group_peace,treaty_components_threaten,treaty_components_faction_to_alliance_war,treaty_components_alliance_to_alliance_war,treaty_components_alliance_to_faction_war,treaty_components_coercion,treaty_components_call_vassals_to_arms,treaty_components_group_war,treaty_components_proposer_declares_war_against_target,treaty_components_recipient_declares_war_against_target,treaty_components_region_demand,treaty_components_region_offer,treaty_components_payment_demand,treaty_components_payment_offer,treaty_components_payment_regular_demand,treaty_components_payment_regular_offer,treaty_components_ancillary_demand,treaty_components_ancillary_offer", "yellow_turban_rank_requirement_recipient")
				cm:modify_model():enable_diplomacy("faction:"..faction_key, "subculture:3k_dlc06_subculture_nanman", "treaty_components_peace,treaty_components_alliance_to_alliance_group_peace,treaty_components_alliance_to_faction_group_peace,treaty_components_faction_to_alliance_group_peace,treaty_components_threaten,treaty_components_faction_to_alliance_war,treaty_components_alliance_to_alliance_war,treaty_components_alliance_to_faction_war,treaty_components_coercion,treaty_components_call_vassals_to_arms,treaty_components_group_war,treaty_components_proposer_declares_war_against_target,treaty_components_recipient_declares_war_against_target,treaty_components_region_demand,treaty_components_region_offer,treaty_components_payment_demand,treaty_components_payment_offer,treaty_components_payment_regular_demand,treaty_components_payment_regular_offer,treaty_components_ancillary_demand,treaty_components_ancillary_offer", "yellow_turban_rank_requirement_proposer")
				cm:modify_model():enable_diplomacy("subculture:3k_dlc06_subculture_nanman", "faction:"..faction_key, "treaty_components_peace,treaty_components_alliance_to_alliance_group_peace,treaty_components_alliance_to_faction_group_peace,treaty_components_faction_to_alliance_group_peace,treaty_components_threaten,treaty_components_faction_to_alliance_war,treaty_components_alliance_to_alliance_war,treaty_components_alliance_to_faction_war,treaty_components_coercion,treaty_components_call_vassals_to_arms,treaty_components_group_war,treaty_components_proposer_declares_war_against_target,treaty_components_recipient_declares_war_against_target,treaty_components_region_demand,treaty_components_region_offer,treaty_components_payment_demand,treaty_components_payment_offer,treaty_components_payment_regular_demand,treaty_components_payment_regular_offer,treaty_components_ancillary_demand,treaty_components_ancillary_offer", "yellow_turban_rank_requirement_recipient")
			end
		},
		{
			progression_level = 3,
			action = function(faction_key)
				cm:modify_model():enable_diplomacy("faction:"..faction_key, "subculture:3k_main_chinese", "treaty_components_trade,treaty_components_food_supply_demand,treaty_components_food_supply_offer", "yellow_turban_rank_requirement_proposer")
				cm:modify_model():enable_diplomacy("subculture:3k_main_chinese", "faction:"..faction_key, "treaty_components_trade,treaty_components_food_supply_demand,treaty_components_food_supply_offer", "yellow_turban_rank_requirement_recipient")
				cm:modify_model():enable_diplomacy("faction:"..faction_key, "subculture:3k_dlc05_subculture_bandits", "treaty_components_trade,treaty_components_food_supply_demand,treaty_components_food_supply_offer", "yellow_turban_rank_requirement_proposer")
				cm:modify_model():enable_diplomacy("subculture:3k_dlc05_subculture_bandits", "faction:"..faction_key, "treaty_components_trade,treaty_components_food_supply_demand,treaty_components_food_supply_offer", "yellow_turban_rank_requirement_recipient")
				cm:modify_model():enable_diplomacy("faction:"..faction_key, "subculture:3k_dlc06_subculture_nanman", "treaty_components_trade,treaty_components_food_supply_demand,treaty_components_food_supply_offer", "yellow_turban_rank_requirement_proposer")
				cm:modify_model():enable_diplomacy("subculture:3k_dlc06_subculture_nanman", "faction:"..faction_key, "treaty_components_trade,treaty_components_food_supply_demand,treaty_components_food_supply_offer", "yellow_turban_rank_requirement_recipient")
			end
		},
		{
			progression_level = 5,
			action = function(faction_key)
				cm:modify_model():enable_diplomacy("faction:"..faction_key, "subculture:3k_main_chinese", "treaty_components_annex_vassal,treaty_components_break_deal_proposer_to_recipient_unilateral,treaty_components_create_alliance,treaty_components_declare_independence,treaty_components_draw_vassal_into_war,treaty_components_food_supply_demand,treaty_components_food_supply_offer,treaty_components_alliance_to_alliance_group_peace,treaty_components_alliance_to_faction_group_peace,treaty_components_faction_to_alliance_group_peace,treaty_components_group_war,treaty_components_join_alliance_proposers,treaty_components_join_alliance_recipients,treaty_components_join_coalition_proposer,treaty_components_join_coalition_recipient,treaty_components_liberate_proposer,treaty_components_liberate_recipient,treaty_components_military_access,treaty_components_non_aggression,treaty_components_vassalise_recipient_yellow_turban,treaty_components_create_coalition,treaty_components_offer_autonomy,treaty_components_demand_autonomy,treaty_components_vassal_requests_war,treaty_components_vassal_joins_war,treaty_components_create_empire,treaty_components_join_empire_proposer,treaty_components_join_empire_recipient", "yellow_turban_rank_requirement_proposer")
				cm:modify_model():enable_diplomacy("faction:"..faction_key, "subculture:3k_dlc06_subculture_nanman", "treaty_components_annex_vassal,treaty_components_break_deal_proposer_to_recipient_unilateral,treaty_components_create_alliance,treaty_components_declare_independence,treaty_components_draw_vassal_into_war,treaty_components_food_supply_demand,treaty_components_food_supply_offer,treaty_components_alliance_to_alliance_group_peace,treaty_components_alliance_to_faction_group_peace,treaty_components_faction_to_alliance_group_peace,treaty_components_group_war,treaty_components_join_alliance_proposers,treaty_components_join_alliance_recipients,treaty_components_join_coalition_proposer,treaty_components_join_coalition_recipient,treaty_components_liberate_proposer,treaty_components_liberate_recipient,treaty_components_military_access,treaty_components_non_aggression,treaty_components_vassalise_recipient_yellow_turban,treaty_components_create_coalition,treaty_components_offer_autonomy,treaty_components_demand_autonomy,treaty_components_vassal_requests_war,treaty_components_vassal_joins_war,treaty_components_create_empire,treaty_components_join_empire_proposer,treaty_components_join_empire_recipient", "yellow_turban_rank_requirement_proposer")
				cm:modify_model():enable_diplomacy("faction:"..faction_key, "subculture:3k_dlc05_subculture_bandits", "treaty_components_annex_vassal,treaty_components_break_deal_proposer_to_recipient_unilateral,treaty_components_confederate_proposer,treaty_components_confederate_recipient,treaty_components_create_alliance,treaty_components_declare_independence,treaty_components_draw_vassal_into_war,treaty_components_food_supply_demand,treaty_components_food_supply_offer,treaty_components_alliance_to_alliance_group_peace,treaty_components_alliance_to_faction_group_peace,treaty_components_faction_to_alliance_group_peace,treaty_components_group_war,treaty_components_join_alliance_proposers,treaty_components_join_alliance_recipients,treaty_components_join_coalition_proposer,treaty_components_join_coalition_recipient,treaty_components_liberate_proposer,treaty_components_liberate_recipient,treaty_components_military_access,treaty_components_non_aggression,treaty_components_vassalise_recipient_yellow_turban,treaty_components_create_coalition,treaty_components_offer_autonomy,treaty_components_demand_autonomy,treaty_components_vassal_requests_war,treaty_components_vassal_joins_war,treaty_components_create_empire,treaty_components_join_empire_proposer,treaty_components_join_empire_recipient", "yellow_turban_rank_requirement_proposer")
				cm:modify_model():enable_diplomacy("faction:"..faction_key, "subculture:3k_main_subculture_yellow_turban", "treaty_components_vassalise_recipient,treaty_components_confederate_recipient", "yellow_turban_rank_requirement_proposer")
				cm:modify_model():disable_diplomacy("faction:"..faction_key, "faction:3k_main_faction_yellow_turban_generic", "treaty_components_vassalise_recipient,treaty_components_confederate_recipient", "yellow_turban_rank_requirement_proposer")
				
				cm:modify_model():enable_diplomacy("subculture:3k_main_chinese", "faction:"..faction_key, "treaty_components_annex_vassal,treaty_components_break_deal_proposer_to_recipient_unilateral,treaty_components_confederate_proposer,treaty_components_confederate_recipient,treaty_components_create_alliance,treaty_components_declare_independence,treaty_components_draw_vassal_into_war,treaty_components_food_supply_demand,treaty_components_food_supply_offer,treaty_components_alliance_to_alliance_group_peace,treaty_components_alliance_to_faction_group_peace,treaty_components_faction_to_alliance_group_peace,treaty_components_group_war,treaty_components_join_alliance_proposers,treaty_components_join_alliance_recipients,treaty_components_join_coalition_proposer,treaty_components_join_coalition_recipient,treaty_components_liberate_proposer,treaty_components_liberate_recipient,treaty_components_military_access,treaty_components_non_aggression,treaty_components_vassalise_proposer_yellow_turban,treaty_components_create_coalition,treaty_components_offer_autonomy,treaty_components_demand_autonomy,treaty_components_vassal_requests_war,treaty_components_vassal_joins_war,treaty_components_create_empire,treaty_components_join_empire_proposer,treaty_components_join_empire_recipient", "yellow_turban_rank_requirement_recipient")
				cm:modify_model():enable_diplomacy("subculture:3k_dlc06_subculture_nanman", "faction:"..faction_key, "treaty_components_annex_vassal,treaty_components_break_deal_proposer_to_recipient_unilateral,treaty_components_confederate_proposer,treaty_components_confederate_recipient,treaty_components_create_alliance,treaty_components_declare_independence,treaty_components_draw_vassal_into_war,treaty_components_food_supply_demand,treaty_components_food_supply_offer,treaty_components_alliance_to_alliance_group_peace,treaty_components_alliance_to_faction_group_peace,treaty_components_faction_to_alliance_group_peace,treaty_components_group_war,treaty_components_join_alliance_proposers,treaty_components_join_alliance_recipients,treaty_components_join_coalition_proposer,treaty_components_join_coalition_recipient,treaty_components_liberate_proposer,treaty_components_liberate_recipient,treaty_components_military_access,treaty_components_non_aggression,treaty_components_vassalise_proposer_yellow_turban,treaty_components_create_coalition,treaty_components_offer_autonomy,treaty_components_demand_autonomy,treaty_components_vassal_requests_war,treaty_components_vassal_joins_war,treaty_components_create_empire,treaty_components_join_empire_proposer,treaty_components_join_empire_recipient", "yellow_turban_rank_requirement_recipient")
				cm:modify_model():enable_diplomacy("subculture:3k_dlc05_subculture_bandits", "faction:"..faction_key, "treaty_components_annex_vassal,treaty_components_break_deal_proposer_to_recipient_unilateral,treaty_components_confederate_proposer,treaty_components_confederate_recipient,treaty_components_create_alliance,treaty_components_declare_independence,treaty_components_draw_vassal_into_war,treaty_components_food_supply_demand,treaty_components_food_supply_offer,treaty_components_alliance_to_alliance_group_peace,treaty_components_alliance_to_faction_group_peace,treaty_components_faction_to_alliance_group_peace,treaty_components_group_war,treaty_components_join_alliance_proposers,treaty_components_join_alliance_recipients,treaty_components_join_coalition_proposer,treaty_components_join_coalition_recipient,treaty_components_liberate_proposer,treaty_components_liberate_recipient,treaty_components_military_access,treaty_components_non_aggression,treaty_components_vassalise_proposer_yellow_turban,treaty_components_create_coalition,treaty_components_offer_autonomy,treaty_components_demand_autonomy,treaty_components_vassal_requests_war,treaty_components_vassal_joins_war,treaty_components_create_empire,treaty_components_join_empire_proposer,treaty_components_join_empire_recipient", "yellow_turban_rank_requirement_recipient")
				cm:modify_model():enable_diplomacy("subculture:3k_main_subculture_yellow_turban", "faction:"..faction_key, "treaty_components_vassalise_proposer,treaty_components_confederate_proposer", "yellow_turban_rank_requirement_recipient")
				cm:modify_model():disable_diplomacy("faction:3k_main_faction_yellow_turban_generic", "faction:"..faction_key, "treaty_components_vassalise_proposer,treaty_components_confederate_proposer", "yellow_turban_rank_requirement_recipient")
				-- Bandit treaties are player specific currently, additional checks are required 			
				if cm:query_faction(faction_key):is_human() then
					cm:modify_model():enable_diplomacy("faction:" ..faction_key, "subculture:3k_dlc05_subculture_bandits", "treaty_components_mercenary_contract_recipient_declares_war_against_target,treaty_components_mercenary_counter_contract_recipient_declares_war_against_target","yellow_turban_rank_requirement_proposer")
					cm:modify_model():enable_diplomacy("subculture:3k_dlc05_subculture_bandits", "faction:" ..faction_key, "treaty_components_mercenary_contract_proposer_declares_war_against_target,treaty_components_mercenary_counter_contract_proposer_declares_war_against_target","yellow_turban_rank_requirement_recipient")
				else
					local human_factions = cm:get_human_factions();
					for i = 1, #human_factions do	
						if cm:query_faction(human_factions[i]):subculture() == "3k_dlc05_subculture_bandits" then
							cm:modify_model():enable_diplomacy("faction:"..faction_key,"faction:" .. human_factions[i], "treaty_components_mercenary_contract_recipient_declares_war_against_target,treaty_components_mercenary_counter_contract_recipient_declares_war_against_target","yellow_turban_rank_requirement_proposer")
							cm:modify_model():enable_diplomacy("faction:" .. human_factions[i], "faction:"..faction_key, "treaty_components_mercenary_contract_proposer_declares_war_against_target,treaty_components_mercenary_counter_contract_proposer_declares_war_against_target","yellow_turban_rank_requirement_recipient")
						end;
					end;
				end;		
			end
		}
	};

	local function unlock_yt_treaties_by_progression_level(query_faction)
		local faction_key =  query_faction:name()
		local faction_progression_level = query_faction:progression_level();

		for j = 1, #progression_level_to_action_mapping do
			local current_mapping = progression_level_to_action_mapping[j];

			if faction_progression_level >= current_mapping.progression_level then
				out(string.format("* start_yt_faction_progression_listeners() Unlocking YT treaties for faction %s at level %d", faction_key, current_mapping.progression_level));
				current_mapping.action(faction_key);
			end;
		end;
	end;

	for i = 1, #eligible_faction_list do
		local current_faction_key = eligible_faction_list[i];
		local current_query_faction = cm:query_faction(current_faction_key);

		if current_query_faction and not current_query_faction:is_null_interface() then

			-- YT treaties get 'locked' every time we load campaign. So we'll always go through and re-unlock them when we establish out listeners.
			unlock_yt_treaties_by_progression_level(current_query_faction);

			core:add_listener(
				current_faction_key .. "_yt_progression",		-- name for listener, we can just use the flag name
				"FactionFameLevelUp",							-- event to listen for
				function(context)								-- condition, returns true if the faction starting the turn is the current faction
					return context:faction():name() == current_faction_key;
				end,  
				function(context)
					unlock_yt_treaties_by_progression_level(context:faction());
				end,
				true
			);
		end;
	end
end;


function start_yellow_turban_awaken_from_death_diplomacy_listener()
	core:add_listener(
		"yellow_turban_awaken_from_death_diplomacy_listener",
		"FactionAwakensFromDeath",
		function(context)
			return context:faction():name() == "3k_main_faction_yellow_turban_generic";
		end,
		function(context)
			local yellow_turban_main_faction_keys = {
				"3k_main_faction_yellow_turban_anding",
				"3k_main_faction_yellow_turban_rebels",
				"3k_main_faction_yellow_turban_taishan",
			};
			
			local yt_generic_faction = cm:modify_faction(context:faction());
			
			if yt_generic_faction then
				out("* 3k_main_faction_yellow_turban_generic has awakened from death");
			
				for i = 1, #yellow_turban_main_faction_keys do
					local current_yt_main_faction = cm:query_faction(yellow_turban_main_faction_keys[i]);
					
					if current_yt_main_faction then
						out("\tapplying automatic deal with " .. current_yt_main_faction:name());
						yt_generic_faction:apply_automatic_diplomatic_deal("data_defined_situation_yellow_turban_generic_awaken_from_death", current_yt_main_faction, "faction_key:3k_main_faction_yellow_turban_generic");
					end;
				end;
			else
				script_error("WARNING: 3k_main_faction_yellow_turban_generic has awakened from death but the script couldn't get a modify_faction interface? No automatic diplomacy deal will be applied");
			end;
		end,
		true
	);
end;